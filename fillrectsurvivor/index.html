<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fillRect survivor</title>
    <style>
      body {
        background-color: #222;
        color: aliceblue;
        font-family: monospace;
        text-rendering: optimizeSpeed;
      }
      button {
        border-radius: 0;
      }
    </style>
    <script type="module" crossorigin>(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var e=typeof global==`object`&&global&&global.Object===Object&&global,t=typeof self==`object`&&self&&self.Object===Object&&self,n=e||t||Function(`return this`)(),r=n.Symbol,i=Object.prototype,a=i.hasOwnProperty,o=i.toString,s=r?r.toStringTag:void 0;function c(e){var t=a.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch{}var i=o.call(e);return r&&(t?e[s]=n:delete e[s]),i}var l=c,u=Object.prototype.toString;function d(e){return u.call(e)}var f=d,p=`[object Null]`,m=`[object Undefined]`,h=r?r.toStringTag:void 0;function g(e){return e==null?e===void 0?m:p:h&&h in Object(e)?l(e):f(e)}var _=g;function v(e){return typeof e==`object`&&!!e}var y=v,b=`[object Symbol]`;function x(e){return typeof e==`symbol`||y(e)&&_(e)==b}var S=x;function ee(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var C=ee,w=Array.isArray,te=1/0,ne=r?r.prototype:void 0,re=ne?ne.toString:void 0;function ie(e){if(typeof e==`string`)return e;if(w(e))return C(e,ie)+``;if(S(e))return re?re.call(e):``;var t=e+``;return t==`0`&&1/e==-te?`-0`:t}var ae=ie,oe=/\s/;function se(e){for(var t=e.length;t--&&oe.test(e.charAt(t)););return t}var ce=se,le=/^\s+/;function ue(e){return e&&e.slice(0,ce(e)+1).replace(le,``)}var de=ue;function fe(e){var t=typeof e;return e!=null&&(t==`object`||t==`function`)}var T=fe,pe=NaN,me=/^[-+]0x[0-9a-f]+$/i,he=/^0b[01]+$/i,ge=/^0o[0-7]+$/i,_e=parseInt;function ve(e){if(typeof e==`number`)return e;if(S(e))return pe;if(T(e)){var t=typeof e.valueOf==`function`?e.valueOf():e;e=T(t)?t+``:t}if(typeof e!=`string`)return e===0?e:+e;e=de(e);var n=he.test(e);return n||ge.test(e)?_e(e.slice(2),n?2:8):me.test(e)?pe:+e}var ye=ve,be=1/0,xe=17976931348623157e292;function Se(e){return e?(e=ye(e),e===be||e===-be?(e<0?-1:1)*xe:e===e?e:0):e===0?e:0}var E=Se;function Ce(e){var t=E(e),n=t%1;return t===t?n?t-n:t:0}var we=Ce;function Te(e){return e}var Ee=Te,De=`[object AsyncFunction]`,Oe=`[object Function]`,ke=`[object GeneratorFunction]`,Ae=`[object Proxy]`;function je(e){if(!T(e))return!1;var t=_(e);return t==Oe||t==ke||t==De||t==Ae}var Me=je,Ne=n[`__core-js_shared__`],Pe=function(){var e=/[^.]+$/.exec(Ne&&Ne.keys&&Ne.keys.IE_PROTO||``);return e?`Symbol(src)_1.`+e:``}();function Fe(e){return!!Pe&&Pe in e}var Ie=Fe,Le=Function.prototype.toString;function Re(e){if(e!=null){try{return Le.call(e)}catch{}try{return e+``}catch{}}return``}var D=Re,ze=/[\\^$.*+?()[\]{}|]/g,Be=/^\[object .+?Constructor\]$/,Ve=Function.prototype,He=Object.prototype,Ue=Ve.toString,We=He.hasOwnProperty,Ge=RegExp(`^`+Ue.call(We).replace(ze,`\\$&`).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,`$1.*?`)+`$`);function Ke(e){return!T(e)||Ie(e)?!1:(Me(e)?Ge:Be).test(D(e))}var qe=Ke;function Je(e,t){return e?.[t]}var Ye=Je;function Xe(e,t){var n=Ye(e,t);return qe(n)?n:void 0}var O=Xe,Ze=O(n,`WeakMap`);function Qe(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var $e=Qe,et=800,tt=16,nt=Date.now;function rt(e){var t=0,n=0;return function(){var r=nt(),i=tt-(r-n);if(n=r,i>0){if(++t>=et)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var it=rt;function at(e){return function(){return e}}var ot=at,st=function(){try{var e=O(Object,`defineProperty`);return e({},``,{}),e}catch{}}(),ct=it(st?function(e,t){return st(e,`toString`,{configurable:!0,enumerable:!1,value:ot(t),writable:!0})}:Ee);function lt(e,t,n,r){for(var i=e.length,a=n+(r?1:-1);r?a--:++a<i;)if(t(e[a],a,e))return a;return-1}var ut=lt;function dt(e){return e!==e}var ft=dt;function pt(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}var mt=pt;function ht(e,t,n){return t===t?mt(e,t,n):ut(e,ft,n)}var gt=ht;function _t(e,t){return!!(e!=null&&e.length)&&gt(e,t,0)>-1}var vt=_t,yt=9007199254740991,bt=/^(?:0|[1-9]\d*)$/;function xt(e,t){var n=typeof e;return t??=yt,!!t&&(n==`number`||n!=`symbol`&&bt.test(e))&&e>-1&&e%1==0&&e<t}var St=xt;function Ct(e,t,n){t==`__proto__`&&st?st(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var wt=Ct;function Tt(e,t){return e===t||e!==e&&t!==t}var Et=Tt,Dt=Math.max;function Ot(e,t,n){return t=Dt(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,a=Dt(r.length-t,0),o=Array(a);++i<a;)o[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(o),$e(e,this,s)}}var kt=Ot;function At(e,t){return ct(kt(e,t,Ee),e+``)}var jt=At,Mt=9007199254740991;function Nt(e){return typeof e==`number`&&e>-1&&e%1==0&&e<=Mt}var Pt=Nt;function Ft(e){return e!=null&&Pt(e.length)&&!Me(e)}var It=Ft;function Lt(e,t,n){if(!T(n))return!1;var r=typeof t;return(r==`number`?It(n)&&St(t,n.length):r==`string`&&t in n)?Et(n[t],e):!1}var Rt=Lt,zt=Object.prototype;function Bt(e){var t=e&&e.constructor,n=typeof t==`function`&&t.prototype||zt;return e===n}var Vt=Bt;function Ht(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var Ut=Ht,Wt=`[object Arguments]`;function Gt(e){return y(e)&&_(e)==Wt}var Kt=Gt,qt=Object.prototype,Jt=qt.hasOwnProperty,Yt=qt.propertyIsEnumerable,Xt=Kt(function(){return arguments}())?Kt:function(e){return y(e)&&Jt.call(e,`callee`)&&!Yt.call(e,`callee`)};function Zt(){return!1}var Qt=Zt,$t=typeof exports==`object`&&exports&&!exports.nodeType&&exports,en=$t&&typeof module==`object`&&module&&!module.nodeType&&module,tn=en&&en.exports===$t?n.Buffer:void 0,nn=(tn?tn.isBuffer:void 0)||Qt,rn=`[object Arguments]`,an=`[object Array]`,on=`[object Boolean]`,sn=`[object Date]`,cn=`[object Error]`,ln=`[object Function]`,un=`[object Map]`,dn=`[object Number]`,fn=`[object Object]`,pn=`[object RegExp]`,mn=`[object Set]`,hn=`[object String]`,gn=`[object WeakMap]`,_n=`[object ArrayBuffer]`,vn=`[object DataView]`,yn=`[object Float32Array]`,bn=`[object Float64Array]`,xn=`[object Int8Array]`,Sn=`[object Int16Array]`,Cn=`[object Int32Array]`,wn=`[object Uint8Array]`,Tn=`[object Uint8ClampedArray]`,En=`[object Uint16Array]`,Dn=`[object Uint32Array]`,k={};k[yn]=k[bn]=k[xn]=k[Sn]=k[Cn]=k[wn]=k[Tn]=k[En]=k[Dn]=!0,k[rn]=k[an]=k[_n]=k[on]=k[vn]=k[sn]=k[cn]=k[ln]=k[un]=k[dn]=k[fn]=k[pn]=k[mn]=k[hn]=k[gn]=!1;function On(e){return y(e)&&Pt(e.length)&&!!k[_(e)]}var kn=On;function An(e){return function(t){return e(t)}}var jn=An,Mn=typeof exports==`object`&&exports&&!exports.nodeType&&exports,A=Mn&&typeof module==`object`&&module&&!module.nodeType&&module,Nn=A&&A.exports===Mn&&e.process,Pn=function(){try{return A&&A.require&&A.require(`util`).types||Nn&&Nn.binding&&Nn.binding(`util`)}catch{}}(),Fn=Pn&&Pn.isTypedArray,In=Fn?jn(Fn):kn,Ln=Object.prototype.hasOwnProperty;function Rn(e,t){var n=w(e),r=!n&&Xt(e),i=!n&&!r&&nn(e),a=!n&&!r&&!i&&In(e),o=n||r||i||a,s=o?Ut(e.length,String):[],c=s.length;for(var l in e)(t||Ln.call(e,l))&&!(o&&(l==`length`||i&&(l==`offset`||l==`parent`)||a&&(l==`buffer`||l==`byteLength`||l==`byteOffset`)||St(l,c)))&&s.push(l);return s}var zn=Rn;function Bn(e,t){return function(n){return e(t(n))}}var Vn=Bn(Object.keys,Object),Hn=Object.prototype.hasOwnProperty;function Un(e){if(!Vt(e))return Vn(e);var t=[];for(var n in Object(e))Hn.call(e,n)&&n!=`constructor`&&t.push(n);return t}var Wn=Un;function Gn(e){return It(e)?zn(e):Wn(e)}var Kn=Gn,qn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Jn=/^\w*$/;function Yn(e,t){if(w(e))return!1;var n=typeof e;return n==`number`||n==`symbol`||n==`boolean`||e==null||S(e)?!0:Jn.test(e)||!qn.test(e)||t!=null&&e in Object(t)}var Xn=Yn,j=O(Object,`create`);function Zn(){this.__data__=j?j(null):{},this.size=0}var Qn=Zn;function $n(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var er=$n,tr=`__lodash_hash_undefined__`,nr=Object.prototype.hasOwnProperty;function rr(e){var t=this.__data__;if(j){var n=t[e];return n===tr?void 0:n}return nr.call(t,e)?t[e]:void 0}var ir=rr,ar=Object.prototype.hasOwnProperty;function or(e){var t=this.__data__;return j?t[e]!==void 0:ar.call(t,e)}var sr=or,cr=`__lodash_hash_undefined__`;function lr(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=j&&t===void 0?cr:t,this}var ur=lr;function M(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}M.prototype.clear=Qn,M.prototype.delete=er,M.prototype.get=ir,M.prototype.has=sr,M.prototype.set=ur;var dr=M;function fr(){this.__data__=[],this.size=0}var pr=fr;function mr(e,t){for(var n=e.length;n--;)if(Et(e[n][0],t))return n;return-1}var hr=mr,gr=Array.prototype.splice;function _r(e){var t=this.__data__,n=hr(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():gr.call(t,n,1),--this.size,!0}var vr=_r;function yr(e){var t=this.__data__,n=hr(t,e);return n<0?void 0:t[n][1]}var br=yr;function xr(e){return hr(this.__data__,e)>-1}var Sr=xr;function Cr(e,t){var n=this.__data__,r=hr(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var wr=Cr;function N(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}N.prototype.clear=pr,N.prototype.delete=vr,N.prototype.get=br,N.prototype.has=Sr,N.prototype.set=wr;var Tr=N,P=O(n,`Map`);function Er(){this.size=0,this.__data__={hash:new dr,map:new(P||Tr),string:new dr}}var Dr=Er;function Or(e){var t=typeof e;return t==`string`||t==`number`||t==`symbol`||t==`boolean`?e!==`__proto__`:e===null}var kr=Or;function Ar(e,t){var n=e.__data__;return kr(t)?n[typeof t==`string`?`string`:`hash`]:n.map}var jr=Ar;function Mr(e){var t=jr(this,e).delete(e);return this.size-=t?1:0,t}var Nr=Mr;function Pr(e){return jr(this,e).get(e)}var Fr=Pr;function Ir(e){return jr(this,e).has(e)}var Lr=Ir;function Rr(e,t){var n=jr(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var zr=Rr;function F(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}F.prototype.clear=Dr,F.prototype.delete=Nr,F.prototype.get=Fr,F.prototype.has=Lr,F.prototype.set=zr;var I=F,Br=`Expected a function`;function Vr(e,t){if(typeof e!=`function`||t!=null&&typeof t!=`function`)throw TypeError(Br);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var o=e.apply(this,r);return n.cache=a.set(i,o)||a,o};return n.cache=new(Vr.Cache||I),n}Vr.Cache=I;var Hr=Vr,Ur=500;function Wr(e){var t=Hr(e,function(e){return n.size===Ur&&n.clear(),e}),n=t.cache;return t}var Gr=Wr,Kr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,qr=/\\(\\)?/g,Jr=Gr(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(``),e.replace(Kr,function(e,n,r,i){t.push(r?i.replace(qr,`$1`):n||e)}),t});function Yr(e){return e==null?``:ae(e)}var Xr=Yr;function Zr(e,t){return w(e)?e:Xn(e,t)?[e]:Jr(Xr(e))}var Qr=Zr,$r=1/0;function ei(e){if(typeof e==`string`||S(e))return e;var t=e+``;return t==`0`&&1/e==-$r?`-0`:t}var ti=ei;function ni(e,t){t=Qr(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ti(t[n++])];return n&&n==r?e:void 0}var ri=ni;function ii(e,t,n){var r=e==null?void 0:ri(e,t);return r===void 0?n:r}var ai=ii;function oi(e,t){for(var n=-1,r=t.length,i=Array(r),a=e==null;++n<r;)i[n]=a?void 0:ai(e,t[n]);return i}var si=oi;function ci(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var li=ci,ui=r?r.isConcatSpreadable:void 0;function di(e){return w(e)||Xt(e)||!!(ui&&e&&e[ui])}var fi=di;function pi(e,t,n,r,i){var a=-1,o=e.length;for(n||=fi,i||=[];++a<o;){var s=e[a];t>0&&n(s)?t>1?pi(s,t-1,n,r,i):li(i,s):r||(i[i.length]=s)}return i}var mi=pi;function hi(e){return e!=null&&e.length?mi(e,1):[]}var gi=hi;function _i(e){return ct(kt(e,void 0,gi),e+``)}var vi=_i(si);function yi(){this.__data__=new Tr,this.size=0}var bi=yi;function xi(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}var Si=xi;function Ci(e){return this.__data__.get(e)}var wi=Ci;function Ti(e){return this.__data__.has(e)}var Ei=Ti,Di=200;function Oi(e,t){var n=this.__data__;if(n instanceof Tr){var r=n.__data__;if(!P||r.length<Di-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new I(r)}return n.set(e,t),this.size=n.size,this}var ki=Oi;function L(e){this.size=(this.__data__=new Tr(e)).size}L.prototype.clear=bi,L.prototype.delete=Si,L.prototype.get=wi,L.prototype.has=Ei,L.prototype.set=ki;var Ai=L;function ji(e,t){for(var n=-1,r=e==null?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a}var Mi=ji;function Ni(){return[]}var Pi=Ni,Fi=Object.prototype.propertyIsEnumerable,Ii=Object.getOwnPropertySymbols,Li=Ii?function(e){return e==null?[]:(e=Object(e),Mi(Ii(e),function(t){return Fi.call(e,t)}))}:Pi;function Ri(e,t,n){var r=t(e);return w(e)?r:li(r,n(e))}var zi=Ri;function Bi(e){return zi(e,Kn,Li)}var Vi=Bi,Hi=O(n,`DataView`),Ui=O(n,`Promise`),Wi=O(n,`Set`),Gi=`[object Map]`,Ki=`[object Object]`,qi=`[object Promise]`,Ji=`[object Set]`,Yi=`[object WeakMap]`,Xi=`[object DataView]`,Zi=D(Hi),Qi=D(P),$i=D(Ui),ea=D(Wi),ta=D(Ze),R=_;(Hi&&R(new Hi(new ArrayBuffer(1)))!=Xi||P&&R(new P)!=Gi||Ui&&R(Ui.resolve())!=qi||Wi&&R(new Wi)!=Ji||Ze&&R(new Ze)!=Yi)&&(R=function(e){var t=_(e),n=t==Ki?e.constructor:void 0,r=n?D(n):``;if(r)switch(r){case Zi:return Xi;case Qi:return Gi;case $i:return qi;case ea:return Ji;case ta:return Yi}return t});var na=R,ra=n.Uint8Array,ia=`__lodash_hash_undefined__`;function aa(e){return this.__data__.set(e,ia),this}var oa=aa;function sa(e){return this.__data__.has(e)}var ca=sa;function la(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new I;++t<n;)this.add(e[t])}la.prototype.add=la.prototype.push=oa,la.prototype.has=ca;var ua=la;function da(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var fa=da;function pa(e,t){return e.has(t)}var ma=pa,ha=1,ga=2;function _a(e,t,n,r,i,a){var o=n&ha,s=e.length,c=t.length;if(s!=c&&!(o&&c>s))return!1;var l=a.get(e),u=a.get(t);if(l&&u)return l==t&&u==e;var d=-1,f=!0,p=n&ga?new ua:void 0;for(a.set(e,t),a.set(t,e);++d<s;){var m=e[d],h=t[d];if(r)var g=o?r(h,m,d,t,e,a):r(m,h,d,e,t,a);if(g!==void 0){if(g)continue;f=!1;break}if(p){if(!fa(t,function(e,t){if(!ma(p,t)&&(m===e||i(m,e,n,r,a)))return p.push(t)})){f=!1;break}}else if(!(m===h||i(m,h,n,r,a))){f=!1;break}}return a.delete(e),a.delete(t),f}var va=_a;function ya(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}var ba=ya;function xa(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var Sa=xa,Ca=1,wa=2,Ta=`[object Boolean]`,Ea=`[object Date]`,Da=`[object Error]`,Oa=`[object Map]`,ka=`[object Number]`,Aa=`[object RegExp]`,ja=`[object Set]`,Ma=`[object String]`,Na=`[object Symbol]`,Pa=`[object ArrayBuffer]`,Fa=`[object DataView]`,Ia=r?r.prototype:void 0,La=Ia?Ia.valueOf:void 0;function Ra(e,t,n,r,i,a,o){switch(n){case Fa:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Pa:return!(e.byteLength!=t.byteLength||!a(new ra(e),new ra(t)));case Ta:case Ea:case ka:return Et(+e,+t);case Da:return e.name==t.name&&e.message==t.message;case Aa:case Ma:return e==t+``;case Oa:var s=ba;case ja:var c=r&Ca;if(s||=Sa,e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=wa,o.set(e,t);var u=va(s(e),s(t),r,i,a,o);return o.delete(e),u;case Na:if(La)return La.call(e)==La.call(t)}return!1}var za=Ra,Ba=1,Va=Object.prototype.hasOwnProperty;function Ha(e,t,n,r,i,a){var o=n&Ba,s=Vi(e),c=s.length,l=Vi(t).length;if(c!=l&&!o)return!1;for(var u=c;u--;){var d=s[u];if(!(o?d in t:Va.call(t,d)))return!1}var f=a.get(e),p=a.get(t);if(f&&p)return f==t&&p==e;var m=!0;a.set(e,t),a.set(t,e);for(var h=o;++u<c;){d=s[u];var g=e[d],_=t[d];if(r)var v=o?r(_,g,d,t,e,a):r(g,_,d,e,t,a);if(!(v===void 0?g===_||i(g,_,n,r,a):v)){m=!1;break}h||=d==`constructor`}if(m&&!h){var y=e.constructor,b=t.constructor;y!=b&&`constructor`in e&&`constructor`in t&&!(typeof y==`function`&&y instanceof y&&typeof b==`function`&&b instanceof b)&&(m=!1)}return a.delete(e),a.delete(t),m}var Ua=Ha,Wa=1,Ga=`[object Arguments]`,Ka=`[object Array]`,qa=`[object Object]`,Ja=Object.prototype.hasOwnProperty;function Ya(e,t,n,r,i,a){var o=w(e),s=w(t),c=o?Ka:na(e),l=s?Ka:na(t);c=c==Ga?qa:c,l=l==Ga?qa:l;var u=c==qa,d=l==qa,f=c==l;if(f&&nn(e)){if(!nn(t))return!1;o=!0,u=!1}if(f&&!u)return a||=new Ai,o||In(e)?va(e,t,n,r,i,a):za(e,t,c,n,r,i,a);if(!(n&Wa)){var p=u&&Ja.call(e,`__wrapped__`),m=d&&Ja.call(t,`__wrapped__`);if(p||m){var h=p?e.value():e,g=m?t.value():t;return a||=new Ai,i(h,g,n,r,a)}}return f?(a||=new Ai,Ua(e,t,n,r,i,a)):!1}var Xa=Ya;function Za(e,t,n,r,i){return e===t?!0:e==null||t==null||!y(e)&&!y(t)?e!==e&&t!==t:Xa(e,t,n,r,Za,i)}var Qa=Za,$a=1,eo=2;function to(e,t,n,r){var i=n.length,a=i,o=!r;if(e==null)return!a;for(e=Object(e);i--;){var s=n[i];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<a;){s=n[i];var c=s[0],l=e[c],u=s[1];if(o&&s[2]){if(l===void 0&&!(c in e))return!1}else{var d=new Ai;if(r)var f=r(l,u,c,e,t,d);if(!(f===void 0?Qa(u,l,$a|eo,r,d):f))return!1}}return!0}var no=to;function ro(e){return e===e&&!T(e)}var io=ro;function ao(e){for(var t=Kn(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,io(i)]}return t}var oo=ao;function so(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}var co=so;function lo(e){var t=oo(e);return t.length==1&&t[0][2]?co(t[0][0],t[0][1]):function(n){return n===e||no(n,e,t)}}var uo=lo;function fo(e,t){return e!=null&&t in Object(e)}var po=fo;function mo(e,t,n){t=Qr(t,e);for(var r=-1,i=t.length,a=!1;++r<i;){var o=ti(t[r]);if(!(a=e!=null&&n(e,o)))break;e=e[o]}return a||++r!=i?a:(i=e==null?0:e.length,!!i&&Pt(i)&&St(o,i)&&(w(e)||Xt(e)))}var ho=mo;function go(e,t){return e!=null&&ho(e,t,po)}var _o=go,vo=1,yo=2;function bo(e,t){return Xn(e)&&io(t)?co(ti(e),t):function(n){var r=ai(n,e);return r===void 0&&r===t?_o(n,e):Qa(t,r,vo|yo)}}var xo=bo;function So(e){return function(t){return t?.[e]}}var Co=So;function wo(e){return function(t){return ri(t,e)}}var To=wo;function Eo(e){return Xn(e)?Co(ti(e)):To(e)}var Do=Eo;function Oo(e){return typeof e==`function`?e:e==null?Ee:typeof e==`object`?w(e)?xo(e[0],e[1]):uo(e):Do(e)}var ko=Oo;function Ao(e){return function(t,n,r){for(var i=-1,a=Object(t),o=r(t),s=o.length;s--;){var c=o[e?s:++i];if(n(a[c],c,a)===!1)break}return t}}var jo=Ao();function Mo(e,t){return e&&jo(e,t,Kn)}var No=Mo,Po=function(){return n.Date.now()},Fo=`Expected a function`,Io=Math.max,Lo=Math.min;function Ro(e,t,n){var r,i,a,o,s,c,l=0,u=!1,d=!1,f=!0;if(typeof e!=`function`)throw TypeError(Fo);t=ye(t)||0,T(n)&&(u=!!n.leading,d=`maxWait`in n,a=d?Io(ye(n.maxWait)||0,t):a,f=`trailing`in n?!!n.trailing:f);function p(t){var n=r,a=i;return r=i=void 0,l=t,o=e.apply(a,n),o}function m(e){return l=e,s=setTimeout(_,t),u?p(e):o}function h(e){var n=e-c,r=e-l,i=t-n;return d?Lo(i,a-r):i}function g(e){var n=e-c,r=e-l;return c===void 0||n>=t||n<0||d&&r>=a}function _(){var e=Po();if(g(e))return v(e);s=setTimeout(_,h(e))}function v(e){return s=void 0,f&&r?p(e):(r=i=void 0,o)}function y(){s!==void 0&&clearTimeout(s),l=0,r=c=i=s=void 0}function b(){return s===void 0?o:v(Po())}function x(){var e=Po(),n=g(e);if(r=arguments,i=this,c=e,n){if(s===void 0)return m(c);if(d)return clearTimeout(s),s=setTimeout(_,t),p(c)}return s===void 0&&(s=setTimeout(_,t)),o}return x.cancel=y,x.flush=b,x}var zo=Ro;function Bo(e){return y(e)&&It(e)}var Vo=Bo;function Ho(e,t,n){for(var r=-1,i=e==null?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}var Uo=Ho,Wo=200;function Go(e,t,n,r){var i=-1,a=vt,o=!0,s=e.length,c=[],l=t.length;if(!s)return c;n&&(t=C(t,jn(n))),r?(a=Uo,o=!1):t.length>=Wo&&(a=ma,o=!1,t=new ua(t));outer:for(;++i<s;){var u=e[i],d=n==null?u:n(u);if(u=r||u!==0?u:0,o&&d===d){for(var f=l;f--;)if(t[f]===d)continue outer;c.push(u)}else a(t,d,r)||c.push(u)}return c}var Ko=Go;function qo(e){return typeof e==`function`?e:Ee}var Jo=qo;function Yo(e,t){var n={};return t=ko(t,3),No(e,function(e,r,i){wt(n,r,t(e,r,i))}),n}var Xo=Yo,Zo=Math.floor,Qo=Math.random;function $o(e,t){return e+Zo(Qo()*(t-e+1))}var es=$o,ts=parseFloat,ns=Math.min,rs=Math.random;function os(e,t,n){if(n&&typeof n!=`boolean`&&Rt(e,t,n)&&(t=n=void 0),n===void 0&&(typeof t==`boolean`?(n=t,t=void 0):typeof e==`boolean`&&(n=e,e=void 0)),e===void 0&&t===void 0?(e=0,t=1):(e=E(e),t===void 0?(t=e,e=0):t=E(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var i=rs();return ns(e+i*(t-e+ts(`1e-`+((i+``).length-1))),t)}return es(e,t)}var z=os,ss=Math.ceil,cs=Math.max;function ls(e,t,n,r){for(var i=-1,a=cs(ss((t-e)/(n||1)),0),o=Array(a);a--;)o[r?a:++i]=e,e+=n;return o}var us=ls;function ds(e){return function(t,n,r){return r&&typeof r!=`number`&&Rt(t,n,r)&&(n=r=void 0),t=E(t),n===void 0?(n=t,t=0):n=E(n),r=r===void 0?t<n?1:-1:E(r),us(t,n,r,e)}}var B=ds(),fs=9007199254740991,ps=4294967295,ms=Math.min;function hs(e,t){if(e=we(e),e<1||e>fs)return[];var n=ps,r=ms(e,ps);t=Jo(t),e-=ps;for(var i=Ut(r,t);++n<e;)t(n);return i}var gs=hs,_s=Math.max;function vs(e){if(!(e&&e.length))return[];var t=0;return e=Mi(e,function(e){if(Vo(e))return t=_s(e.length,t),!0}),Ut(t,function(t){return C(e,Co(t))})}var ys=vs,bs=jt(function(e,t){return Vo(e)?Ko(e,t):[]}),xs=jt(ys),Ss=class{free_ids=[];next_id=0;components=[];systems=[];resources=new Map;create_entity(...e){let t=this.free_ids.pop()??this.next_id++;for(let[n,r]of e)this.add_component(t,n,r);return t}has_component(e,t){return this.components[t].has(e)}get_component(e,t){return this.components[t].get(e)}get_opt_component(e,t){return this.components[t].has(e)?this.components[t].get(e):null}add_component(e,t,n){let r=this.components[t];return r.has(e)?r.data[r.sparse[e]]=n:r.add(e,n),n}remove_component(e,t){let n=this.components[t];n.has(e)&&n.remove(e)}delete_entity(e){for(let t of this.components)t.has(e)&&t.remove(e);this.free_ids.push(e)}query(...e){let t=vi(this.components,e).reduce((e,t,n,r)=>e=t.data.length<r[n].data.length?n:e,0),n=vi(this.components,e),r=vi(this.components,bs(e,t)),i=[];for(let e of this.components[t].dense)r.every(t=>t.has(e))&&i.push([e,...n.map(t=>t.data[t.sparse[e]])]);return i}register_component(e){this.components[e]=new Cs}add_systems(...e){this.systems.push(...e)}run(){for(let e of this.systems)e(this)}loop=()=>{this.run(),this.just_started=!1,this.raf_id=requestAnimationFrame(this.loop)};raf_id=null;just_started=!1;start(){this.raf_id||(this.raf_id=requestAnimationFrame(this.loop),this.just_started=!0)}stop(){this.raf_id&&=(cancelAnimationFrame(this.raf_id),null)}step(){this.stop(),this.just_started=!0,this.run()}},Cs=class{sparse=[];dense=[];data=[];has(e){return this.dense[this.sparse[e]]===e}add(e,t){this.sparse[e]=this.dense.push(e)-1,this.data.push(t)}get(e){return this.data[this.sparse[e]]}remove(e){let t=this.sparse[e],n=this.dense.length-1;this.sparse[this.dense[n]]=t,this.dense[t]=this.dense[n],this.dense.pop(),this.data[t]=this.data[n],this.data.pop()}};function ws(e,t){let n=e.s+t.s;return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n}function Ts(e){let t=[],n=0;for(;e;)e&1&&t.push(n),e>>=1,n++;return t}var Es=class{grid;n_cols;n_rows;entity_map;constructor(e,t,n,r){this.w=e,this.h=t,this.cell_size=n,this.collision_layers=r,this.n_cols=Math.ceil(e/n),this.n_rows=Math.ceil(t/n),this.grid=gs(this.collision_layers,()=>gs(this.n_rows,()=>gs(this.n_cols,()=>[]))),this.entity_map=new Map}reset(){for(let e of this.grid)for(let t of e)for(let e of t)e.length=0;this.entity_map.clear()}to_grid_indexes(e){let{x:t,y:n,s:r}=e,i=e=>Math.floor(e/this.cell_size),a=Math.max(0,i(t-r)),o=Math.min(this.n_cols-1,i(t+r)),s=Math.max(0,i(n-r)),c=Math.min(this.n_rows-1,i(n+r));return a<=o&&s<=c?[a,o,s,c]:[]}get_layers(e){return vi(this.grid,Ts(e))}query(e,t){let n=new Set,r=this.get_layers(e),i=this.to_grid_indexes(t);if(i.length===0)return[];let[a,o,s,c]=i;for(let e of r)for(let r=a;r<=o;r++)for(let i=s;i<=c;i++)for(let a of e[i][r])ws(t,this.entity_map.get(a))&&n.add(a);return[...n]}insert(e,t,n){let r=this.to_grid_indexes(n);if(r.length===0)return;let i=this.get_layers(t);this.entity_map.set(e,n);let[a,o,s,c]=r;for(let t of i)for(let n=a;n<=o;n++)for(let r=s;r<=c;r++)t[r][n].push(e)}};const V={zero:()=>({x:0,y:0}),add:(e,t)=>({x:e.x+t.x,y:e.y+t.y}),sub:(e,t)=>({x:e.x-t.x,y:e.y-t.y}),mul:(e,t)=>typeof e==`number`?{x:t.x*e,y:t.y*e}:{x:e.x*t.x,y:e.y*t.y},dot:(e,t)=>e.x*t.x+e.y*t.y,mag:e=>Math.hypot(e.x,e.y),sq_mag:e=>e.x**2+e.y**2,normed:e=>{let t=Math.hypot(e.x,e.y)+2**-52;return{x:e.x/t,y:e.y/t}},dist:(e,t)=>Math.hypot(e.x-t.x,e.y-t.y),angle:e=>Math.atan2(e.y,e.x),from_angle:(e,t=1)=>({x:Math.cos(e)*t,y:Math.sin(e)*t}),rotate:(e,t)=>{let n=Math.cos(e),r=Math.sin(e),i=t.x*n-t.y*r,a=t.x*r+t.y*n;return{x:i,y:a}},floor:e=>({x:Math.floor(e.x),y:Math.floor(e.y)})};var Ds=[`#00ff2a5b`,`#1e1c21`,`#6f7078`,`#afb3b8`,`#ff00ffff`,`#6b36b1ff`,`#31e0ffff`,`#00b41bff`,`#e47600ff`,`#e03d6eff`,`#ffd900ff`,`#0004ffff`];let H=function(e){return e[e.Slime=0]=`Slime`,e[e.Black=1]=`Black`,e[e.Grey=2]=`Grey`,e[e.Silver=3]=`Silver`,e[e.Pink=4]=`Pink`,e[e.Indigo=5]=`Indigo`,e[e.Cyan=6]=`Cyan`,e[e.Green=7]=`Green`,e[e.Orange=8]=`Orange`,e[e.Red=9]=`Red`,e[e.Yellow=10]=`Yellow`,e[e.Blue=11]=`Blue`,e[e.cardinality=12]=`cardinality`,e}({});var Os,U,ks;onmessage=e=>{let t=e.data;if(t.type===`init`){U=new OffscreenCanvas(t.w,t.h),ks=U.getContext(`2d`),Os=t.worker_id;return}if(t.type===`render`){let e=U.width,n=U.height;ks.clearRect(0,0,e,n);let{frame_id:r,pos:i,size:a,color:o}=t;for(let e=0;e<i.length;e++){let t=a[e];ks.fillStyle=Ds[o[e]],ks.fillRect(Math.floor(i[e].x-t),Math.floor(i[e].y-t),Math.floor(2*t),Math.floor(2*t))}createImageBitmap(U).then(e=>{let t={type:`bmp`,frame_id:r,worker_id:Os,bmp:e};postMessage(t,{transfer:[e]})});return}};var As=[[0,0,0],[0,255,255],[255,0,255],[255,255,0],[255,0,0],[0,255,0],[0,0,255]];let W=function(e){return e[e.White=0]=`White`,e[e.Red=1]=`Red`,e[e.Green=2]=`Green`,e[e.Blue=3]=`Blue`,e[e.Cyan=4]=`Cyan`,e[e.Magenta=5]=`Magenta`,e[e.Yellow=6]=`Yellow`,e}({});var js=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFCAYAAABSIVz6AAAAdElEQVR4AZTOQQ4DIQxD0Xbuf+eWF9WSFU0XgzB2fhDk+tR6/Vah2+jabeMBvDzyPou3DpqNTTiHvHXwbHxCHRhBnJLnY2Arw+OdU3PqXme9CN/578cumq7VbOfUfMsbGCd5Pu6JwAhvhcfT6zq53T01J/kLAAD//8R2uWMAAAAGSURBVAMAGC7Dq7DPgRkAAAAASUVORK5CYII=`,Ms=class{bmp;promise;constructor(e){this.promise=fetch(js).then(t=>t.blob().then(t=>createImageBitmap(t).then(t=>{if(e){let n=t.width,r=t.height,i=new OffscreenCanvas(n,r).getContext(`2d`);i.drawImage(t,0,0);let a=i.getImageData(0,0,n,r),o=a.data;for(let t=0;t<o.length;t+=4)for(let n=0;n<3;n++)o[t+n]-=e[n];return createImageBitmap(a).then(e=>this.bmp=e)}else return this.bmp=t})))}draw(e,t,n,r){let i=t.toString().split(``).map(Number);e.fillRect(n,r,4*i.length+1,7);for(let t=0;t<i.length;t++)e.drawImage(this.bmp,3*i[t],0,3,5,n+4*t+1,r+1,3,5)}},Ns,G,Ps,Fs=As.map(e=>new Ms(e)),Is,Ls=!1;onmessage=e=>{let t=e.data;if(t.type===`init`){G=new OffscreenCanvas(t.w,t.h),Ps=G.getContext(`2d`,{willReadFrequently:!0}),Ns=t.worker_id,Promise.all(Fs.map(e=>e.promise)).then(e=>{Ls=!0;let t={type:`ready`,worker_id:Ns};postMessage(t)});return}if(t.type===`render`){if(!Ls)return;let{w:e,h:n}={w:G.width,h:G.height},{frame_id:r,pos:i,dmg:a,color:o}=t;Is!==void 0&&r-Is;let s=Ps.getImageData(0,0,e,n),c=s.data;for(let e=3;e<c.length;e+=4)c[e]-=Math.sqrt(256-c[e]);Ps.putImageData(s,0,0);for(let e=0;e<i.length;e++)Fs[o[e]].draw(Ps,a[e],Math.floor(i[e].x),Math.floor(i[e].y));createImageBitmap(G).then(e=>{let t={type:`bmp`,frame_id:r,worker_id:Ns,bmp:e};postMessage(t,{transfer:[e]})}),Is=r;return}};var Rs=class{state;constructor(e){this.state=e*e+1>>>0}next_u32(){let e=this.state;return e^=e<<13,e^=e>>>17,e^=e<<5,e>>>=0,this.state=e,e}rand_float(e,t){if(e===void 0)return this.next_u32()/4294967296;t===void 0&&(t=e,e=0);let n=this.next_u32()/4294967296;return e+n*(t-e)}rand_int(e,t){return t===void 0&&(t=e,e=0),Math.floor(this.rand_float(e,t+1))}rand_pick(e){return e[this.rand_int(e.length-1)]}};const zs={new_rect(){return{x:0,y:0,w:0,h:0}},in_bounds(e,t){return t.x>=e.x&&t.x<e.x+e.w&&t.y>=e.y&&t.y<e.y+e.h},clamp(e,t){return{x:Math.max(e.x,Math.min(e.x+e.w,t.x)),y:Math.max(e.y,Math.min(e.y+e.h,t.y))}},expand(e,t){return{x:e.x-t,y:e.y-t,w:e.w+2*t,h:e.h+2*t}}};var K=function(e){return e[e.Pos=0]=`Pos`,e[e.Vel=1]=`Vel`,e[e.Size=2]=`Size`,e[e.Color=3]=`Color`,e[e.Value=4]=`Value`,e[e.Stationary=5]=`Stationary`,e[e.cardinality=6]=`cardinality`,e}(K||{}),Bs=function(e){return e[e.COIN=1]=`COIN`,e[e.PICKER=2]=`PICKER`,e}(Bs||{}),Vs=class{ecs=new Ss;grid;constructor(e){this.bounds=e,B(K.cardinality).forEach(e=>this.ecs.register_component(e)),this.grid=new Es(e.w,e.h,10,1)}spawn_coin_pile(e,t,n){let r=0;for(;r<4&&e>=2e3;){let i=10**Math.floor(Math.log10(e)),a=[5*i,2*i,i].find(t=>e>=t);e-=a,r++,this.ecs.create_entity([K.Pos,zs.clamp(this.bounds,t)],[K.Vel,V.add(n,{x:z(-40,40),y:z(-40,40)})],[K.Size,2.5],[K.Color,0],[K.Value,a])}let i=[500,100,20,5,1],a=[0,0,1,1,2],o=[2.5,1.5,1.5,1,1],s=0;for(;r<4&&s<i.length;){let c=i[s];e>=c?(e-=c,r++,this.ecs.create_entity([K.Pos,zs.clamp(this.bounds,t)],[K.Vel,V.add(n,{x:z(-40,40),y:z(-40,40)})],[K.Size,o[s]],[K.Color,a[s]],[K.Value,c])):s++}}physics(e){let t=e/1e3,n=this.ecs.components[K.Pos].data,r=this.ecs.components[K.Vel].data,{w:i,h:a}=this.bounds,o=this.ecs.components[K.Pos].dense;for(let e=0;e<n.length;e++){let s=n[e],c=r[e];(s.x<0&&c.x<0||s.x>i&&c.x>0)&&(c.x*=-1),(s.y<0&&c.y<0||s.y>a&&c.y>0)&&(c.y*=-1);let l=V.sq_mag(c);if(l<1){this.ecs.add_component(o[e],K.Stationary,null);continue}let u=Math.sqrt(l),d=Math.min(u,2);c.x-=d*c.x/u,c.y-=d*c.y/u,s.x+=t*c.x,s.y+=t*c.y}}pick(e,t){let n=[];this.grid.reset();let r=this.ecs.query(K.Stationary,K.Pos,K.Size);for(let[e,t,n,i]of r)this.grid.insert(e,Bs.COIN,{...n,s:i});let i=this.grid.query(Bs.COIN,{...e,s:t});for(let e of i)n.push([this.ecs.components[K.Value].get(e),this.grid.entity_map.get(e)]),this.ecs.delete_entity(e);return n}render(e,t){let n={type:`render`,frame_id:t,pos:this.ecs.components[K.Pos].data,size:this.ecs.components[K.Size].data,color:this.ecs.components[K.Color].data};e.postMessage(n)}},q=class{progress=0;constructor(e){this.interval=e}tick(e){this.progress+=e;let t=this.progress>=this.interval;return t&&(this.progress=0),t}tick_n(e){this.progress+=e;let t=0;for(;this.progress>=this.interval;)this.progress-=this.interval,t++;return t}remaining(){return this.interval-this.progress}},Hs={atk_speed:[2,e=>100+10*e],max_hit:[5,e=>e+2],hardness_count:[5,e=>Gs(e)/2,`number of bounces or pierces`],hardness_mult:[5,e=>.3+2*e/(e+100),`damage mult per bounce or pierce`],bullets:[5,e=>1+Gs(e)/2],mastery:[1,e=>e*.05,`when mastery > 1, min and max hit are swapped`],crit_chance:[1,e=>.1+e/100,`can hyper crit`],crit_mult:[1,e=>1.5+.1*e],frost_on_hit:[1,e=>2*e],loot_mult:[5,e=>1+e*.1],coin_picker:[1,e=>5+e],regen:[1,e=>e]},Us=class{attack_timer;mana_progress;mana_gain;upgrades;hp;money;constructor(e,t){this.position=e,this.cfg=t,this.attack_timer=new q(250),this.mana_progress=new q(100),this.mana_gain=1,this.upgrades=Xo(Hs,([e,t,n],r)=>new Ws(r,e,t,n)),this.hp=t.starting_hp,this.money=t.starting_money}tick(e){this.attack_timer.interval=4e4/this.upgrades.atk_speed.value;let t=this.attack_timer.tick_n(e),n=this.mana_progress.tick(e*this.mana_gain/1e3);return{n_attacks:t,mana_ready:n}}bullet_velocity(){return 400}roll_damage(){let e=this.upgrades.max_hit.value,t=this.upgrades.mastery.value*e,n=e>t?z(t,e):z(e,t),r=this.upgrades.crit_chance.value,i=this.upgrades.crit_mult.value,a=0;for(;Math.random()<r;)a++,--r;let o=n*i**a;return{crits:a,dmg:o}}},Ws=class{level=0;_value;constructor(e,t,n,r){this.name=e,this.cost=t,this.str=r,this._value=n}next_cost(){return Math.ceil(this.cost*1.1)}level_up(){this.level++,this.cost=this.next_cost()}get value(){return this._value(this.level)}get next_value(){return this._value(this.level+1)}};function Gs(e){return(-1+Math.sqrt(1+8*e))/2}var Ks=class{rng;wave_timer;mob_timer;wave_remaining_mobs=0;wave_modifiers=[];wave_number=0;mob_queue=[];kills=0;constructor(e){this.seed=e;let t=3e4;this.wave_timer=new q(t),this.wave_timer.progress=t,this.mob_timer=new q(0),this.rng=new Rs(e)}tick(e){if(this.wave_timer.tick(e)){this.wave_number++;let e=new Set;for(let t=0;t<this.wave_number/4;t++)e.add(this.rng.rand_int(J.cardinality-1));this.wave_modifiers=[...e],this.wave_remaining_mobs=this.is_boss_wave()?1:5+this.wave_number,this.mob_timer.interval=this.is_boss_wave()?.1*this.wave_timer.interval:.7*this.wave_timer.interval/this.wave_remaining_mobs}return this.wave_remaining_mobs&&this.mob_timer.tick(e)&&this.enqueue_mob(),this.mob_queue.pop()}enqueue_mob(){let e=B(H.Grey,H.cardinality),t=this.wave_number,n=3*1.1**t,r=.1*Math.sqrt(.1*this.wave_number),i=this.wave_modifiers.filter(e=>this.rng.rand_float()<r),a=new Set(i),o={approach_speed:8+.5*t,strafe_speed:z(0,10+2*t),chirality:Math.random()<.5?-1:1,max_hp:n,loot:.5*n,size:4,color:a.has(J.Slime)?H.Slime:e[(this.seed+t)%e.length],mods:a};if(this.is_boss_wave()){let e=(5+t)*2;o.max_hp*=e,o.loot*=e,o.strafe_speed*=.1,o.size*=5}i.forEach(e=>qs(this.rng,e,o)),this.wave_remaining_mobs--,this.mob_queue.push(o)}is_boss_wave(){return this.wave_number%10==0}anger(){B(this.wave_remaining_mobs).forEach(e=>this.enqueue_mob()),this.wave_timer.progress=this.wave_timer.interval}};let J=function(e){return e[e.Armored=0]=`Armored`,e[e.Fast=1]=`Fast`,e[e.Slime=2]=`Slime`,e[e.cardinality=3]=`cardinality`,e}({});function qs(e,t,n){switch(t){case J.Armored:n.size*=2.5,n.loot*=5,n.strafe_speed*=.3,n.approach_speed*=.5;break;case J.Fast:n.size*=.75,n.max_hp*=.5,n.approach_speed*=2,n.loot*=2;break;case J.Slime:n.max_hp*=.5,n.size*=1.5,n.loot*=3;break}}var Js=class{options=[];rng;reroll_cost=1;constructor(e,t){this.player=e,this.rng=new Rs(t),this.free_reroll()}free_reroll(){let e=Object.values(this.player.upgrades);this.options=B(3).map(t=>{let n=e[this.rng.rand_int(e.length-1)];return{i:t,upgradable:n,purchased:!1}})}reroll(){this.player.money<this.reroll_cost||(this.player.money-=this.reroll_cost,this.free_reroll())}purchase(e){let t=this.options[e],n=t.upgradable,r=n.cost;this.player.money<r||(t.purchased=!0,this.player.money-=r,n.level_up(),this.options.every(e=>e.purchased===!0)&&this.free_reroll(),this.options=[...this.options])}},Y=class{_value;callbacks=[];constructor(e){this._value=e}get value(){return this._value}set value(e){e!==this._value&&(this.callbacks.forEach(t=>t(e)),this._value=e)}subscribe(e){this.callbacks.push(e),e(this._value)}},Ys=class{root;death_screen;event_queue=[];money=new Y(0);d_money=new Y(0);options=new Y([]);wave_number=new Y(0);mobs_remain=new Y(0);wave_duration_remain=new Y(0);hp=new Y(0);kills=new Y(0);_stage;_disable_key_listener=!1;key_listener;constructor(e,t,n,r,i){this.shop=e,this.player=t,this.stage=n,this.canvas=r,this._stage=new Y(n),this.root=document.createElement(`div`);let a=document.createElement(`div`),o=new Text,s=new Text,c=new Text;a.append(`wave `,o,` (`,c,`)`),this.wave_number.subscribe(e=>o.textContent=e.toString()),this.mobs_remain.subscribe(e=>s.textContent=e.toString()),this.wave_duration_remain.subscribe(e=>c.textContent=(e/1e3).toFixed(2));let l=document.createElement(`div`);this.kills.subscribe(e=>l.innerText=`kill count ${e}`);let u=document.createElement(`div`);this.hp.subscribe(e=>u.innerText=`hp ${e.toFixed(0)}`);let d=document.createElement(`div`),f=new Text,p=new Text,m=zo(()=>p.textContent=``,300);d.append(`money `,f,p),this.money.subscribe(e=>f.textContent=e.toString()),this.d_money.subscribe(e=>{e>0?p.textContent=` +${e}`:m()});let h=document.createElement(`button`);h.innerText=`[R]eroll $${e.reroll_cost}`,h.onclick=()=>this.shop.reroll(),this.money.subscribe(t=>h.disabled=t<e.reroll_cost);let g=document.createElement(`button`);g.innerText=`A[n]ger`,g.id=`angerbutton`,g.onclick=()=>{let e=this.stage.wave_timer;this.player.money+=Math.floor((e.interval-e.progress)/1e3),this.stage.anger()};let _=document.createElement(`div`),v=(e,t)=>{_.replaceChildren(...e.map((e,n)=>{let r=document.createElement(`button`),i=e.upgradable;return r.disabled=e.purchased,r.innerHTML=`[${`QWE`[n]}] <span>$${i.cost}</span> ${i.name} ${b(i.value)}->${b(i.next_value)}`,r.getElementsByTagName(`span`)[0].style.color=i.cost>t?`red`:`green`,r.onclick=()=>{this.shop.purchase(e.i),x()},r}))};this.options.subscribe(e=>v(e,this.money.value)),this.money.subscribe(e=>v(this.options.value,e));let y=document.createElement(`pre`),b=e=>Number.isInteger(e)?e:e.toFixed(2),x=()=>{y.innerText=Object.values(this.player.upgrades).map(e=>`${e.name.padEnd(15)}: ${b(e.value).toString().padEnd(4)} lv${e.level.toString().padEnd(3)} ${e.str??``}`).join(`
`)};x(),this._stage.subscribe(e=>x());let S=document.createElement(`div`);S.innerText=`debug: [A] start [S] stop [D] step [F] reset stage`;let ee=document.createElement(`pre`);ee.innerText=`changelog:
coin value no longer capped at 500
bullets scaling improved
bullet hardness reworked
bullet can hit same enemy again after bouncing
every stat except atk speed scales infinitely
`,this.root.append(a,l,u,d,h,g,_,y,S,ee),this.key_listener=e=>{if(!this._disable_key_listener)switch(e.key){case`r`:h.click();break;case`n`:g.click();break;case`q`:_.children[0].click();break;case`w`:_.children[1].click();break;case`e`:_.children[2].click();break}},this.death_screen=document.createElement(`div`);let C=this.death_screen,w=this.canvas.getBoundingClientRect();C.style.display=`none`,C.style.position=`absolute`,C.style.zIndex=`${Number(this.canvas.style.zIndex)+1}`,C.style.left=`${w.left}px`,C.style.top=`${w.top}px`,C.style.width=`${w.width}px`,C.style.height=`${w.height}px`,C.style.backgroundColor=`rgba(0, 0, 0, 0.8)`,C.innerHTML=`
            <h1 style="color: red">YOU DIED</h1>
            <p></p>
            <p></p>
            <p>click to continue</p>`,C.onclick=()=>{i(),C.style.display=`none`}}reset(e,t,n){this.player=e,this.shop=t,this.stage=n,this.root.querySelector(`#angerbutton`).disabled=!1,this._disable_key_listener=!1}overlay_death_screen(e,t){this.death_screen.style.display=`block`;let n=this.death_screen.getElementsByTagName(`p`);n[0].innerHTML=`kills: ${e} best score: ${Math.max(e,t)}.`+(e>t?` starting money updated.`:``);var r=e>1e4?[`one second of eternity has passed`]:e>1e3?[`every thousand years the bird carries away one grain of sand`]:e>200?[`stronger tomorrow`]:e>50?[`greedy...`]:e>10?[`no mouth to cry suffering`]:[`zamn, u are dead`,`couldn't square it`];n[1].innerHTML=r[z(r.length-1)],this._disable_key_listener=!0,this.root.querySelectorAll(`button`).forEach(e=>e.disabled=!0)}update(){this.d_money.value=this.player.money-this.money.value,this.money.value=this.player.money,this.options.value=this.shop.options,this.wave_number.value=this.stage.wave_number,this.mobs_remain.value=this.stage.wave_remaining_mobs,this.wave_duration_remain.value=this.stage.wave_timer.remaining(),this.hp.value=this.player.hp,this.kills.value=this.stage.kills,this._stage.value=this.stage}},Xs=[`coins`,`squares`,`damagenumbers`];function Zs(e){let t=new Worker(new URL(``+new URL(`compositor-DGqOZO1l.js`,import.meta.url).href,``+import.meta.url),{type:`module`}),n=e.transferControlToOffscreen(),r={type:`init`,offscreen:n,n_layers:Xs.length};t.postMessage(r,{transfer:[n]});let i=[new Worker(new URL(``+new URL(`coins-ClbqWE0v.js`,import.meta.url).href,``+import.meta.url),{type:`module`}),new Worker(new URL(``+new URL(`squares-Dmw0ObVW.js`,import.meta.url).href,``+import.meta.url),{type:`module`}),new Worker(new URL(``+new URL(`damagenumbers-D1IHdlhJ.js`,import.meta.url).href,``+import.meta.url),{type:`module`})],a=Xs.map((n,r)=>{let a=i[r],o={type:`init`,worker_id:r,w:e.width,h:e.height};return a.onmessage=e=>{let n=e.data;if(n.type===`bmp`){let{bmp:e}=n;t.postMessage(n,{transfer:[e]})}},a.postMessage(o),a});return window.onmessage=e=>{e.data.type},Object.fromEntries(xs(Xs,a))}var X=function(e){return e[e.Pos=0]=`Pos`,e[e.Vel=1]=`Vel`,e[e.EdgeReflect=2]=`EdgeReflect`,e[e.Square=3]=`Square`,e[e.CollisionMask=4]=`CollisionMask`,e[e.Color=5]=`Color`,e[e.ZIndex=6]=`ZIndex`,e[e.Bullet=7]=`Bullet`,e[e.Enemy=8]=`Enemy`,e[e.Frost=9]=`Frost`,e[e.PlayerMarker=10]=`PlayerMarker`,e[e.cardinality=11]=`cardinality`,e}(X||{}),Qs=function(e){return e[e.PLAYER=1]=`PLAYER`,e[e.ENEMY=2]=`ENEMY`,e}(Qs||{}),Z=function(e){return e[e.Time=0]=`Time`,e[e.DeltaTime=1]=`DeltaTime`,e[e.Frame=2]=`Frame`,e[e.CanvasManager=3]=`CanvasManager`,e[e.CollisionGrid=4]=`CollisionGrid`,e[e.Player=5]=`Player`,e[e.Stage=6]=`Stage`,e[e.RenderWorkers=7]=`RenderWorkers`,e[e.CoinManager=8]=`CoinManager`,e[e.RenderDamageNumbers=9]=`RenderDamageNumbers`,e[e.Shop=10]=`Shop`,e[e.Persistent=11]=`Persistent`,e[e.UI=12]=`UI`,e}(Z||{}),$s=class{scaling=1;mouse_input={x:0,y:0};constructor(e){this.canvas=e,e.addEventListener(`pointermove`,t=>{let n=e.getBoundingClientRect();this.mouse_input.x=(t.x-n.x)/this.scaling,this.mouse_input.y=(t.y-n.y)/this.scaling})}get bounds(){return{x:0,y:0,w:this.canvas.width,h:this.canvas.height}}set_scaling(e){this.scaling=e,this.canvas.style.width=`${e*vc}px`,this.canvas.style.height=`${e*yc}px`,this.canvas.style.imageRendering=`pixelated`}};function ec(e){let t=performance.now(),n=e.resources.get(Z.Time),r=e.just_started?17:t-n;e.resources.set(Z.Time,t),e.resources.set(Z.DeltaTime,r),e.resources.set(Z.Frame,e.resources.get(Z.Frame)+1)}function tc(e,t,n,r){let i=e.create_entity([X.Pos,r],[X.Vel,V.zero()],[X.Square,[n.size]],[X.Color,[n.color]],[X.ZIndex,1],[X.CollisionMask,Qs.ENEMY]),a={...n,hp:n.max_hp,hash:(i+100)*(t+100)};e.add_component(i,X.Enemy,a)}function nc(e){let t=e.resources.get(Z.DeltaTime),n=e.resources.get(Z.Frame),r=e.resources.get(Z.Stage),i=e.resources.get(Z.Player),a=e.resources.get(Z.CanvasManager),o=Math.max(...Object.values(a.bounds))/2,s=r.tick(t);if(s){let{add:t,mul:r,from_angle:a}=V,c=a(z(2*Math.PI)),l=t(i.position,r(o,c));tc(e,n,s,l)}}function rc(e){let t=e.query(X.Enemy,X.Pos,X.Vel),n=e.resources.get(Z.Player),{add:r,sub:i,normed:a,mul:o}=V;for(let[e,{approach_speed:s,strafe_speed:c,chirality:l},u,d]of t){let e=a(i(n.position,u)),t={x:e.y,y:-e.x};Object.assign(d,r(o(s,e),o(l*c,t)))}}function ic(e){let t=e.resources.get(Z.DeltaTime);e.resources.get(Z.Frame);let n=e.resources.get(Z.Player),r=e.resources.get(Z.CanvasManager);if(n.hp<=0)return;let{n_attacks:i,mana_ready:a}=n.tick(t);for(let t=0;t<i;t++){let i=Math.floor(n.upgrades.bullets.value),a=n.bullet_velocity(),o=n.position,s=(1+t/7)*Math.PI/72,c=-.5*(i-1)*s,{sub:l,normed:u,mul:d,rotate:f}=V,p=u(l(r.mouse_input,o));for(let t of B(i)){let n=d(a,f(c+t*s,p)),r={collided:new Set,bounces:0};e.create_entity([X.Bullet,r],[X.Pos,{...o}],[X.Vel,n],[X.Square,[1]],[X.Color,[H.Cyan]],[X.ZIndex,2])}}}function ac(e){let t=e.query(X.Bullet),n=e.resources.get(Z.Player).upgrades.hardness_count.value;for(let[r,i]of t)i.bounces>n&&e.delete_entity(r)}function oc(e){let t=e.resources.get(Z.DeltaTime)/1e3,n=e.query(X.Pos,X.Vel),r=e.resources.get(Z.CanvasManager),i=e.components[X.Bullet],{w:a,h:o}=r.bounds;for(let[r,s,c]of n){if(i.has(r)){let e=i.get(r);(s.x<0&&c.x<0||s.x>a&&c.x>0)&&(c.x*=-1,e.bounces+=1,e.collided.clear()),(s.y<0&&c.y<0||s.y>o&&c.y>0)&&(c.y*=-1,e.bounces+=1,e.collided.clear())}let n=e.get_opt_component(r,X.Frost)??[0],l=5/(Math.sqrt(n[0])+5);s.x+=t*l*c.x,s.y+=t*l*c.y}}function sc(e){let t=e.query(X.Frost);for(let[n,r]of t)--r[0],r[0]<=0&&e.remove_component(n,X.Frost)}function cc(e){let t=e.resources.get(Z.CollisionGrid),n=e.query(X.Enemy,X.Pos,X.Square,X.CollisionMask);t.reset();for(let[e,r,i,[a],o]of n)t.insert(e,o,{...i,s:a})}function lc(e){let t=e.query(X.Bullet,X.Pos,X.Square),n=e.query(X.Enemy),r=e.resources.get(Z.Player),i=e.resources.get(Z.CollisionGrid),a=e.resources.get(Z.Stage),o=e.resources.get(Z.UI);e.resources.get(Z.CanvasManager);let s=e.resources.get(Z.Frame),c=e.resources.get(Z.CoinManager),l=e.resources.get(Z.RenderDamageNumbers),u=r.upgrades.loot_mult.value,{mul:d,sub:f,normed:p,add:m}=V,h=new Map(n);{let[t,n,a,[s]]=e.query(X.PlayerMarker,X.Pos,X.Square)[0];for(let e of i.query(Qs.ENEMY,{...a,s})){if(r.hp<=0)break;--r.hp,l.pos.push(m(a,{x:z(-2,2),y:z(-2,2)})),l.dmg.push(1),l.color.push(W.Red)}if(r.hp<=0){let{kills:t,most_kills:n}=gc(e);o.death_screen.style.display===`none`&&o.overlay_death_screen(t,n)}else r.hp+=r.upgrades.regen.value/50}for(let[n,o,m,[g]]of t)for(let t of i.query(Qs.ENEMY,{...m,s:g})){let i=h.get(t);if(!i||i.hp<=0||o.collided.has(i.hash))continue;if(i.mods.has(J.Armored)&&Math.random()<.8){let t=e.components[X.Vel].get(n);Object.assign(t,V.rotate(z(.5*Math.PI,1.5*Math.PI),t)),o.collided.clear();continue}let{dmg:g,crits:_}=r.roll_damage(),v=Math.max(1,Math.floor(g*r.upgrades.hardness_mult.value**o.bounces));l.pos.push(m),l.dmg.push(v),l.color.push([W.White,W.Magenta,W.Blue,W.Cyan,W.Green][_]),i.hp-=v,o.bounces+=1,o.collided.add(i.hash);let y=e.get_opt_component(t,X.Frost)??e.add_component(t,X.Frost,[0]);if(y[0]+=r.upgrades.frost_on_hit.value,i.hp<=0){if(i.mods.has(J.Slime)&&i.size>=3){let n=e.get_component(t,X.Pos),r=i.size;for(let t=0;t<2;t++){let t={...i};t.max_hp/=2,t.size/=Math.SQRT2,t.strafe_speed*=z(.5,.6),t.loot/=2,tc(e,s,t,V.add(n,{x:z(-r,r),y:z(-r,r)}))}}else c.spawn_coin_pile(u*i.loot,m,d(40,p(f(m,r.position)))),a.kills+=1;e.delete_entity(t)}}}function uc(e){let t=e.resources.get(Z.CoinManager),n=e.resources.get(Z.DeltaTime);t.physics(n)}function dc(e){let t=e.resources.get(Z.CoinManager),n=e.resources.get(Z.CanvasManager),r=e.resources.get(Z.RenderDamageNumbers),i=e.resources.get(Z.Player),a=i.upgrades.coin_picker.value;for(let[e,o]of t.pick(n.mouse_input,a))i.money+=e,r.pos.push(o),r.dmg.push(e),r.color.push(W.Yellow)}function fc(e){let t=e.query(X.Pos,X.Square,X.Color,X.ZIndex),n=e.resources.get(Z.RenderWorkers),r=e.resources.get(Z.Frame);function i(){t.sort((e,t)=>e[4]-t[4])}i();let a={type:`render`,frame_id:r,pos:[],size:[],color:[]};for(let[e,n,[r],[i]]of t)a.pos.push(n),a.size.push(r),a.color.push(i);n.squares.postMessage(a)}function pc(e){let t=e.resources.get(Z.CoinManager),n=e.resources.get(Z.RenderWorkers),r=e.resources.get(Z.Frame);t.render(n.coins,r)}function mc(e){let t=e.resources.get(Z.RenderWorkers),n=e.resources.get(Z.Frame),r=e.resources.get(Z.RenderDamageNumbers);r.frame_id=n,t.damagenumbers.postMessage(r),r.pos.length=0,r.dmg.length=0,r.color.length=0}function hc(e){e.resources.get(Z.UI).update()}function gc(e){let t=e.resources.get(Z.Stage)?.kills??0,n=e.resources.get(Z.Persistent);return{persistent:n,most_kills:n.most_kills,kills:t}}function _c(e){let t=e.resources.get(Z.CanvasManager),{persistent:n,most_kills:r,kills:i}=gc(e);n.most_kills=Math.max(r,i),localStorage.setItem(`persistent`,JSON.stringify(n));for(let[t]of e.query(X.Pos))e.delete_entity(t);let a=e.resources.get(Z.CoinManager);for(let[e]of a.ecs.query(X.Pos))a.ecs.delete_entity(e);let o=new Ks(69);e.resources.set(Z.Stage,o);let s=new Us({x:vc/2,y:yc/2},{starting_hp:100,starting_money:n.most_kills});e.resources.set(Z.Player,s),e.create_entity([X.PlayerMarker,{}],[X.Pos,s.position],[X.Square,[2]],[X.Color,[H.Blue]],[X.ZIndex,3]);let c=new Js(s,69);e.resources.set(Z.Shop,c);let l=e.resources.get(Z.UI);if(l)l.reset(s,c,o);else{let n=new Ys(c,s,o,t.canvas,()=>{_c(e)});e.resources.set(Z.UI,n),document.body.append(n.root),document.body.append(n.death_screen),document.onkeydown=n.key_listener}}const Q=new Ss;B(X.cardinality).forEach(e=>Q.register_component(e)),Q.resources.set(Z.Time,0),Q.resources.set(Z.DeltaTime,0),Q.resources.set(Z.Frame,0);var $=document.createElement(`canvas`),vc=400,yc=300;$.height=yc,$.width=vc,document.body.append($);var bc=new $s($);Q.resources.set(Z.CanvasManager,bc),Q.resources.set(Z.CollisionGrid,new Es(vc,yc,10,2)),Q.resources.set(Z.RenderWorkers,Zs($));var xc=new Vs(bc.bounds);Q.resources.set(Z.CoinManager,xc),Q.resources.set(Z.RenderDamageNumbers,{type:`render`,frame_id:0,pos:[],dmg:[],color:[]});var Sc=localStorage.getItem(`persistent`),Cc=Sc?JSON.parse(Sc):{most_kills:0};Q.resources.set(Z.Persistent,Cc),Q.add_systems(ec,nc,ic,ac,rc,oc,sc,cc,lc,uc,dc,fc,pc,mc,hc),bc.set_scaling(2),ec(Q),_c(Q),Q.start();var wc={a:Q.start.bind(Q),s:Q.stop.bind(Q),d:Q.step.bind(Q),f:()=>_c(Q)};document.body.onkeydown=e=>{wc[e.key]?.()};</script>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
