<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fillRect survivor</title>
    <style>
      body {
        background-color: #222;
        color: aliceblue;
        font-family: monospace;
        text-rendering: optimizeSpeed;
      }
      button {
        border-radius: 0;
      }
    </style>
    <script type="module" crossorigin>(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var e=typeof global==`object`&&global&&global.Object===Object&&global,t=typeof self==`object`&&self&&self.Object===Object&&self,n=e||t||Function(`return this`)(),r=n.Symbol,i=Object.prototype,a=i.hasOwnProperty,o=i.toString,s=r?r.toStringTag:void 0;function c(e){var t=a.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch{}var i=o.call(e);return r&&(t?e[s]=n:delete e[s]),i}var l=c,u=Object.prototype.toString;function d(e){return u.call(e)}var f=d,p=`[object Null]`,m=`[object Undefined]`,h=r?r.toStringTag:void 0;function g(e){return e==null?e===void 0?m:p:h&&h in Object(e)?l(e):f(e)}var _=g;function v(e){return typeof e==`object`&&!!e}var y=v,b=`[object Symbol]`;function x(e){return typeof e==`symbol`||y(e)&&_(e)==b}var S=x;function C(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var w=C,T=Array.isArray,ee=1/0,te=r?r.prototype:void 0,ne=te?te.toString:void 0;function re(e){if(typeof e==`string`)return e;if(T(e))return w(e,re)+``;if(S(e))return ne?ne.call(e):``;var t=e+``;return t==`0`&&1/e==-ee?`-0`:t}var ie=re,ae=/\s/;function oe(e){for(var t=e.length;t--&&ae.test(e.charAt(t)););return t}var se=oe,ce=/^\s+/;function le(e){return e&&e.slice(0,se(e)+1).replace(ce,``)}var ue=le;function de(e){var t=typeof e;return e!=null&&(t==`object`||t==`function`)}var E=de,fe=NaN,pe=/^[-+]0x[0-9a-f]+$/i,me=/^0b[01]+$/i,he=/^0o[0-7]+$/i,ge=parseInt;function _e(e){if(typeof e==`number`)return e;if(S(e))return fe;if(E(e)){var t=typeof e.valueOf==`function`?e.valueOf():e;e=E(t)?t+``:t}if(typeof e!=`string`)return e===0?e:+e;e=ue(e);var n=me.test(e);return n||he.test(e)?ge(e.slice(2),n?2:8):pe.test(e)?fe:+e}var ve=_e,ye=1/0,be=17976931348623157e292;function xe(e){return e?(e=ve(e),e===ye||e===-ye?(e<0?-1:1)*be:e===e?e:0):e===0?e:0}var D=xe;function Se(e){var t=D(e),n=t%1;return t===t?n?t-n:t:0}var Ce=Se;function we(e){return e}var Te=we,Ee=`[object AsyncFunction]`,De=`[object Function]`,Oe=`[object GeneratorFunction]`,ke=`[object Proxy]`;function Ae(e){if(!E(e))return!1;var t=_(e);return t==De||t==Oe||t==Ee||t==ke}var je=Ae,Me=n[`__core-js_shared__`],Ne=function(){var e=/[^.]+$/.exec(Me&&Me.keys&&Me.keys.IE_PROTO||``);return e?`Symbol(src)_1.`+e:``}();function Pe(e){return!!Ne&&Ne in e}var Fe=Pe,Ie=Function.prototype.toString;function Le(e){if(e!=null){try{return Ie.call(e)}catch{}try{return e+``}catch{}}return``}var O=Le,Re=/[\\^$.*+?()[\]{}|]/g,ze=/^\[object .+?Constructor\]$/,Be=Function.prototype,Ve=Object.prototype,He=Be.toString,Ue=Ve.hasOwnProperty,We=RegExp(`^`+He.call(Ue).replace(Re,`\\$&`).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,`$1.*?`)+`$`);function Ge(e){return!E(e)||Fe(e)?!1:(je(e)?We:ze).test(O(e))}var Ke=Ge;function qe(e,t){return e?.[t]}var Je=qe;function Ye(e,t){var n=Je(e,t);return Ke(n)?n:void 0}var k=Ye,Xe=k(n,`WeakMap`);function Ze(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var Qe=Ze,$e=800,et=16,tt=Date.now;function nt(e){var t=0,n=0;return function(){var r=tt(),i=et-(r-n);if(n=r,i>0){if(++t>=$e)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var rt=nt;function it(e){return function(){return e}}var at=it,ot=function(){try{var e=k(Object,`defineProperty`);return e({},``,{}),e}catch{}}(),st=rt(ot?function(e,t){return ot(e,`toString`,{configurable:!0,enumerable:!1,value:at(t),writable:!0})}:Te);function ct(e,t,n,r){for(var i=e.length,a=n+(r?1:-1);r?a--:++a<i;)if(t(e[a],a,e))return a;return-1}var lt=ct;function ut(e){return e!==e}var dt=ut;function ft(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}var pt=ft;function mt(e,t,n){return t===t?pt(e,t,n):lt(e,dt,n)}var ht=mt;function gt(e,t){return!!(e!=null&&e.length)&&ht(e,t,0)>-1}var _t=gt,vt=9007199254740991,yt=/^(?:0|[1-9]\d*)$/;function bt(e,t){var n=typeof e;return t??=vt,!!t&&(n==`number`||n!=`symbol`&&yt.test(e))&&e>-1&&e%1==0&&e<t}var xt=bt;function St(e,t,n){t==`__proto__`&&ot?ot(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var Ct=St;function wt(e,t){return e===t||e!==e&&t!==t}var Tt=wt,Et=Math.max;function Dt(e,t,n){return t=Et(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,a=Et(r.length-t,0),o=Array(a);++i<a;)o[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(o),Qe(e,this,s)}}var Ot=Dt;function kt(e,t){return st(Ot(e,t,Te),e+``)}var At=kt,jt=9007199254740991;function Mt(e){return typeof e==`number`&&e>-1&&e%1==0&&e<=jt}var Nt=Mt;function Pt(e){return e!=null&&Nt(e.length)&&!je(e)}var Ft=Pt;function It(e,t,n){if(!E(n))return!1;var r=typeof t;return(r==`number`?Ft(n)&&xt(t,n.length):r==`string`&&t in n)?Tt(n[t],e):!1}var Lt=It,Rt=Object.prototype;function zt(e){var t=e&&e.constructor,n=typeof t==`function`&&t.prototype||Rt;return e===n}var Bt=zt;function Vt(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var Ht=Vt,Ut=`[object Arguments]`;function Wt(e){return y(e)&&_(e)==Ut}var Gt=Wt,Kt=Object.prototype,qt=Kt.hasOwnProperty,Jt=Kt.propertyIsEnumerable,Yt=Gt(function(){return arguments}())?Gt:function(e){return y(e)&&qt.call(e,`callee`)&&!Jt.call(e,`callee`)};function Xt(){return!1}var Zt=Xt,Qt=typeof exports==`object`&&exports&&!exports.nodeType&&exports,$t=Qt&&typeof module==`object`&&module&&!module.nodeType&&module,en=$t&&$t.exports===Qt?n.Buffer:void 0,tn=(en?en.isBuffer:void 0)||Zt,nn=`[object Arguments]`,rn=`[object Array]`,an=`[object Boolean]`,on=`[object Date]`,sn=`[object Error]`,cn=`[object Function]`,ln=`[object Map]`,un=`[object Number]`,dn=`[object Object]`,fn=`[object RegExp]`,pn=`[object Set]`,mn=`[object String]`,hn=`[object WeakMap]`,gn=`[object ArrayBuffer]`,_n=`[object DataView]`,vn=`[object Float32Array]`,yn=`[object Float64Array]`,bn=`[object Int8Array]`,xn=`[object Int16Array]`,Sn=`[object Int32Array]`,Cn=`[object Uint8Array]`,wn=`[object Uint8ClampedArray]`,Tn=`[object Uint16Array]`,En=`[object Uint32Array]`,A={};A[vn]=A[yn]=A[bn]=A[xn]=A[Sn]=A[Cn]=A[wn]=A[Tn]=A[En]=!0,A[nn]=A[rn]=A[gn]=A[an]=A[_n]=A[on]=A[sn]=A[cn]=A[ln]=A[un]=A[dn]=A[fn]=A[pn]=A[mn]=A[hn]=!1;function Dn(e){return y(e)&&Nt(e.length)&&!!A[_(e)]}var On=Dn;function kn(e){return function(t){return e(t)}}var An=kn,jn=typeof exports==`object`&&exports&&!exports.nodeType&&exports,j=jn&&typeof module==`object`&&module&&!module.nodeType&&module,Mn=j&&j.exports===jn&&e.process,Nn=function(){try{return j&&j.require&&j.require(`util`).types||Mn&&Mn.binding&&Mn.binding(`util`)}catch{}}(),Pn=Nn&&Nn.isTypedArray,Fn=Pn?An(Pn):On,In=Object.prototype.hasOwnProperty;function Ln(e,t){var n=T(e),r=!n&&Yt(e),i=!n&&!r&&tn(e),a=!n&&!r&&!i&&Fn(e),o=n||r||i||a,s=o?Ht(e.length,String):[],c=s.length;for(var l in e)(t||In.call(e,l))&&!(o&&(l==`length`||i&&(l==`offset`||l==`parent`)||a&&(l==`buffer`||l==`byteLength`||l==`byteOffset`)||xt(l,c)))&&s.push(l);return s}var Rn=Ln;function zn(e,t){return function(n){return e(t(n))}}var Bn=zn(Object.keys,Object),Vn=Object.prototype.hasOwnProperty;function Hn(e){if(!Bt(e))return Bn(e);var t=[];for(var n in Object(e))Vn.call(e,n)&&n!=`constructor`&&t.push(n);return t}var Un=Hn;function Wn(e){return Ft(e)?Rn(e):Un(e)}var Gn=Wn,Kn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,qn=/^\w*$/;function Jn(e,t){if(T(e))return!1;var n=typeof e;return n==`number`||n==`symbol`||n==`boolean`||e==null||S(e)?!0:qn.test(e)||!Kn.test(e)||t!=null&&e in Object(t)}var Yn=Jn,M=k(Object,`create`);function Xn(){this.__data__=M?M(null):{},this.size=0}var Zn=Xn;function Qn(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var $n=Qn,er=`__lodash_hash_undefined__`,tr=Object.prototype.hasOwnProperty;function nr(e){var t=this.__data__;if(M){var n=t[e];return n===er?void 0:n}return tr.call(t,e)?t[e]:void 0}var rr=nr,ir=Object.prototype.hasOwnProperty;function ar(e){var t=this.__data__;return M?t[e]!==void 0:ir.call(t,e)}var or=ar,sr=`__lodash_hash_undefined__`;function cr(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=M&&t===void 0?sr:t,this}var lr=cr;function N(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}N.prototype.clear=Zn,N.prototype.delete=$n,N.prototype.get=rr,N.prototype.has=or,N.prototype.set=lr;var ur=N;function dr(){this.__data__=[],this.size=0}var fr=dr;function pr(e,t){for(var n=e.length;n--;)if(Tt(e[n][0],t))return n;return-1}var P=pr,mr=Array.prototype.splice;function hr(e){var t=this.__data__,n=P(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():mr.call(t,n,1),--this.size,!0}var gr=hr;function _r(e){var t=this.__data__,n=P(t,e);return n<0?void 0:t[n][1]}var vr=_r;function yr(e){return P(this.__data__,e)>-1}var br=yr;function xr(e,t){var n=this.__data__,r=P(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var Sr=xr;function F(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}F.prototype.clear=fr,F.prototype.delete=gr,F.prototype.get=vr,F.prototype.has=br,F.prototype.set=Sr;var Cr=F,I=k(n,`Map`);function wr(){this.size=0,this.__data__={hash:new ur,map:new(I||Cr),string:new ur}}var Tr=wr;function Er(e){var t=typeof e;return t==`string`||t==`number`||t==`symbol`||t==`boolean`?e!==`__proto__`:e===null}var Dr=Er;function Or(e,t){var n=e.__data__;return Dr(t)?n[typeof t==`string`?`string`:`hash`]:n.map}var kr=Or;function Ar(e){var t=kr(this,e).delete(e);return this.size-=t?1:0,t}var jr=Ar;function Mr(e){return kr(this,e).get(e)}var Nr=Mr;function Pr(e){return kr(this,e).has(e)}var Fr=Pr;function Ir(e,t){var n=kr(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var Lr=Ir;function L(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}L.prototype.clear=Tr,L.prototype.delete=jr,L.prototype.get=Nr,L.prototype.has=Fr,L.prototype.set=Lr;var Rr=L,zr=`Expected a function`;function Br(e,t){if(typeof e!=`function`||t!=null&&typeof t!=`function`)throw TypeError(zr);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var o=e.apply(this,r);return n.cache=a.set(i,o)||a,o};return n.cache=new(Br.Cache||Rr),n}Br.Cache=Rr;var Vr=Br,Hr=500;function Ur(e){var t=Vr(e,function(e){return n.size===Hr&&n.clear(),e}),n=t.cache;return t}var Wr=Ur,Gr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Kr=/\\(\\)?/g,qr=Wr(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(``),e.replace(Gr,function(e,n,r,i){t.push(r?i.replace(Kr,`$1`):n||e)}),t});function Jr(e){return e==null?``:ie(e)}var Yr=Jr;function Xr(e,t){return T(e)?e:Yn(e,t)?[e]:qr(Yr(e))}var Zr=Xr,Qr=1/0;function $r(e){if(typeof e==`string`||S(e))return e;var t=e+``;return t==`0`&&1/e==-Qr?`-0`:t}var ei=$r;function ti(e,t){t=Zr(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ei(t[n++])];return n&&n==r?e:void 0}var ni=ti;function ri(e,t,n){var r=e==null?void 0:ni(e,t);return r===void 0?n:r}var ii=ri;function ai(e,t){for(var n=-1,r=t.length,i=Array(r),a=e==null;++n<r;)i[n]=a?void 0:ii(e,t[n]);return i}var oi=ai;function si(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var ci=si,li=r?r.isConcatSpreadable:void 0;function ui(e){return T(e)||Yt(e)||!!(li&&e&&e[li])}var di=ui;function fi(e,t,n,r,i){var a=-1,o=e.length;for(n||=di,i||=[];++a<o;){var s=e[a];t>0&&n(s)?t>1?fi(s,t-1,n,r,i):ci(i,s):r||(i[i.length]=s)}return i}var pi=fi;function mi(e){return e!=null&&e.length?pi(e,1):[]}var hi=mi;function gi(e){return st(Ot(e,void 0,hi),e+``)}var _i=gi(oi);function vi(){this.__data__=new Cr,this.size=0}var yi=vi;function bi(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}var xi=bi;function Si(e){return this.__data__.get(e)}var Ci=Si;function wi(e){return this.__data__.has(e)}var Ti=wi,Ei=200;function Di(e,t){var n=this.__data__;if(n instanceof Cr){var r=n.__data__;if(!I||r.length<Ei-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Rr(r)}return n.set(e,t),this.size=n.size,this}var Oi=Di;function R(e){this.size=(this.__data__=new Cr(e)).size}R.prototype.clear=yi,R.prototype.delete=xi,R.prototype.get=Ci,R.prototype.has=Ti,R.prototype.set=Oi;var ki=R;function Ai(e,t){for(var n=-1,r=e==null?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a}var ji=Ai;function Mi(){return[]}var Ni=Mi,Pi=Object.prototype.propertyIsEnumerable,Fi=Object.getOwnPropertySymbols,Ii=Fi?function(e){return e==null?[]:(e=Object(e),ji(Fi(e),function(t){return Pi.call(e,t)}))}:Ni;function Li(e,t,n){var r=t(e);return T(e)?r:ci(r,n(e))}var Ri=Li;function zi(e){return Ri(e,Gn,Ii)}var Bi=zi,Vi=k(n,`DataView`),Hi=k(n,`Promise`),Ui=k(n,`Set`),Wi=`[object Map]`,Gi=`[object Object]`,Ki=`[object Promise]`,qi=`[object Set]`,Ji=`[object WeakMap]`,Yi=`[object DataView]`,Xi=O(Vi),Zi=O(I),Qi=O(Hi),$i=O(Ui),ea=O(Xe),z=_;(Vi&&z(new Vi(new ArrayBuffer(1)))!=Yi||I&&z(new I)!=Wi||Hi&&z(Hi.resolve())!=Ki||Ui&&z(new Ui)!=qi||Xe&&z(new Xe)!=Ji)&&(z=function(e){var t=_(e),n=t==Gi?e.constructor:void 0,r=n?O(n):``;if(r)switch(r){case Xi:return Yi;case Zi:return Wi;case Qi:return Ki;case $i:return qi;case ea:return Ji}return t});var ta=z,na=n.Uint8Array,ra=`__lodash_hash_undefined__`;function ia(e){return this.__data__.set(e,ra),this}var aa=ia;function oa(e){return this.__data__.has(e)}var sa=oa;function ca(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Rr;++t<n;)this.add(e[t])}ca.prototype.add=ca.prototype.push=aa,ca.prototype.has=sa;var la=ca;function ua(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var da=ua;function fa(e,t){return e.has(t)}var pa=fa,ma=1,ha=2;function ga(e,t,n,r,i,a){var o=n&ma,s=e.length,c=t.length;if(s!=c&&!(o&&c>s))return!1;var l=a.get(e),u=a.get(t);if(l&&u)return l==t&&u==e;var d=-1,f=!0,p=n&ha?new la:void 0;for(a.set(e,t),a.set(t,e);++d<s;){var m=e[d],h=t[d];if(r)var g=o?r(h,m,d,t,e,a):r(m,h,d,e,t,a);if(g!==void 0){if(g)continue;f=!1;break}if(p){if(!da(t,function(e,t){if(!pa(p,t)&&(m===e||i(m,e,n,r,a)))return p.push(t)})){f=!1;break}}else if(!(m===h||i(m,h,n,r,a))){f=!1;break}}return a.delete(e),a.delete(t),f}var _a=ga;function va(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}var ya=va;function ba(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var xa=ba,Sa=1,Ca=2,wa=`[object Boolean]`,Ta=`[object Date]`,Ea=`[object Error]`,Da=`[object Map]`,Oa=`[object Number]`,ka=`[object RegExp]`,Aa=`[object Set]`,ja=`[object String]`,Ma=`[object Symbol]`,Na=`[object ArrayBuffer]`,Pa=`[object DataView]`,Fa=r?r.prototype:void 0,Ia=Fa?Fa.valueOf:void 0;function La(e,t,n,r,i,a,o){switch(n){case Pa:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Na:return!(e.byteLength!=t.byteLength||!a(new na(e),new na(t)));case wa:case Ta:case Oa:return Tt(+e,+t);case Ea:return e.name==t.name&&e.message==t.message;case ka:case ja:return e==t+``;case Da:var s=ya;case Aa:var c=r&Sa;if(s||=xa,e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=Ca,o.set(e,t);var u=_a(s(e),s(t),r,i,a,o);return o.delete(e),u;case Ma:if(Ia)return Ia.call(e)==Ia.call(t)}return!1}var Ra=La,za=1,Ba=Object.prototype.hasOwnProperty;function Va(e,t,n,r,i,a){var o=n&za,s=Bi(e),c=s.length,l=Bi(t).length;if(c!=l&&!o)return!1;for(var u=c;u--;){var d=s[u];if(!(o?d in t:Ba.call(t,d)))return!1}var f=a.get(e),p=a.get(t);if(f&&p)return f==t&&p==e;var m=!0;a.set(e,t),a.set(t,e);for(var h=o;++u<c;){d=s[u];var g=e[d],_=t[d];if(r)var v=o?r(_,g,d,t,e,a):r(g,_,d,e,t,a);if(!(v===void 0?g===_||i(g,_,n,r,a):v)){m=!1;break}h||=d==`constructor`}if(m&&!h){var y=e.constructor,b=t.constructor;y!=b&&`constructor`in e&&`constructor`in t&&!(typeof y==`function`&&y instanceof y&&typeof b==`function`&&b instanceof b)&&(m=!1)}return a.delete(e),a.delete(t),m}var Ha=Va,Ua=1,Wa=`[object Arguments]`,Ga=`[object Array]`,Ka=`[object Object]`,qa=Object.prototype.hasOwnProperty;function Ja(e,t,n,r,i,a){var o=T(e),s=T(t),c=o?Ga:ta(e),l=s?Ga:ta(t);c=c==Wa?Ka:c,l=l==Wa?Ka:l;var u=c==Ka,d=l==Ka,f=c==l;if(f&&tn(e)){if(!tn(t))return!1;o=!0,u=!1}if(f&&!u)return a||=new ki,o||Fn(e)?_a(e,t,n,r,i,a):Ra(e,t,c,n,r,i,a);if(!(n&Ua)){var p=u&&qa.call(e,`__wrapped__`),m=d&&qa.call(t,`__wrapped__`);if(p||m){var h=p?e.value():e,g=m?t.value():t;return a||=new ki,i(h,g,n,r,a)}}return f?(a||=new ki,Ha(e,t,n,r,i,a)):!1}var Ya=Ja;function Xa(e,t,n,r,i){return e===t?!0:e==null||t==null||!y(e)&&!y(t)?e!==e&&t!==t:Ya(e,t,n,r,Xa,i)}var Za=Xa,Qa=1,$a=2;function eo(e,t,n,r){var i=n.length,a=i,o=!r;if(e==null)return!a;for(e=Object(e);i--;){var s=n[i];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<a;){s=n[i];var c=s[0],l=e[c],u=s[1];if(o&&s[2]){if(l===void 0&&!(c in e))return!1}else{var d=new ki;if(r)var f=r(l,u,c,e,t,d);if(!(f===void 0?Za(u,l,Qa|$a,r,d):f))return!1}}return!0}var to=eo;function no(e){return e===e&&!E(e)}var ro=no;function io(e){for(var t=Gn(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,ro(i)]}return t}var ao=io;function oo(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}var so=oo;function co(e){var t=ao(e);return t.length==1&&t[0][2]?so(t[0][0],t[0][1]):function(n){return n===e||to(n,e,t)}}var lo=co;function uo(e,t){return e!=null&&t in Object(e)}var fo=uo;function po(e,t,n){t=Zr(t,e);for(var r=-1,i=t.length,a=!1;++r<i;){var o=ei(t[r]);if(!(a=e!=null&&n(e,o)))break;e=e[o]}return a||++r!=i?a:(i=e==null?0:e.length,!!i&&Nt(i)&&xt(o,i)&&(T(e)||Yt(e)))}var mo=po;function ho(e,t){return e!=null&&mo(e,t,fo)}var go=ho,_o=1,vo=2;function yo(e,t){return Yn(e)&&ro(t)?so(ei(e),t):function(n){var r=ii(n,e);return r===void 0&&r===t?go(n,e):Za(t,r,_o|vo)}}var bo=yo;function xo(e){return function(t){return t?.[e]}}var So=xo;function Co(e){return function(t){return ni(t,e)}}var wo=Co;function To(e){return Yn(e)?So(ei(e)):wo(e)}var Eo=To;function Do(e){return typeof e==`function`?e:e==null?Te:typeof e==`object`?T(e)?bo(e[0],e[1]):lo(e):Eo(e)}var Oo=Do;function ko(e){return function(t,n,r){for(var i=-1,a=Object(t),o=r(t),s=o.length;s--;){var c=o[e?s:++i];if(n(a[c],c,a)===!1)break}return t}}var Ao=ko();function jo(e,t){return e&&Ao(e,t,Gn)}var Mo=jo,No=function(){return n.Date.now()},Po=`Expected a function`,Fo=Math.max,Io=Math.min;function Lo(e,t,n){var r,i,a,o,s,c,l=0,u=!1,d=!1,f=!0;if(typeof e!=`function`)throw TypeError(Po);t=ve(t)||0,E(n)&&(u=!!n.leading,d=`maxWait`in n,a=d?Fo(ve(n.maxWait)||0,t):a,f=`trailing`in n?!!n.trailing:f);function p(t){var n=r,a=i;return r=i=void 0,l=t,o=e.apply(a,n),o}function m(e){return l=e,s=setTimeout(_,t),u?p(e):o}function h(e){var n=e-c,r=e-l,i=t-n;return d?Io(i,a-r):i}function g(e){var n=e-c,r=e-l;return c===void 0||n>=t||n<0||d&&r>=a}function _(){var e=No();if(g(e))return v(e);s=setTimeout(_,h(e))}function v(e){return s=void 0,f&&r?p(e):(r=i=void 0,o)}function y(){s!==void 0&&clearTimeout(s),l=0,r=c=i=s=void 0}function b(){return s===void 0?o:v(No())}function x(){var e=No(),n=g(e);if(r=arguments,i=this,c=e,n){if(s===void 0)return m(c);if(d)return clearTimeout(s),s=setTimeout(_,t),p(c)}return s===void 0&&(s=setTimeout(_,t)),o}return x.cancel=y,x.flush=b,x}var Ro=Lo;function zo(e){return y(e)&&Ft(e)}var Bo=zo;function Vo(e,t,n){for(var r=-1,i=e==null?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}var Ho=Vo,Uo=200;function Wo(e,t,n,r){var i=-1,a=_t,o=!0,s=e.length,c=[],l=t.length;if(!s)return c;n&&(t=w(t,An(n))),r?(a=Ho,o=!1):t.length>=Uo&&(a=pa,o=!1,t=new la(t));outer:for(;++i<s;){var u=e[i],d=n==null?u:n(u);if(u=r||u!==0?u:0,o&&d===d){for(var f=l;f--;)if(t[f]===d)continue outer;c.push(u)}else a(t,d,r)||c.push(u)}return c}var Go=Wo;function Ko(e){return typeof e==`function`?e:Te}var qo=Ko;function Jo(e,t){var n={};return t=Oo(t,3),Mo(e,function(e,r,i){Ct(n,r,t(e,r,i))}),n}var Yo=Jo,Xo=Math.floor,Zo=Math.random;function Qo(e,t){return e+Xo(Zo()*(t-e+1))}var $o=Qo,es=parseFloat,ts=Math.min,ns=Math.random;function rs(e,t,n){if(n&&typeof n!=`boolean`&&Lt(e,t,n)&&(t=n=void 0),n===void 0&&(typeof t==`boolean`?(n=t,t=void 0):typeof e==`boolean`&&(n=e,e=void 0)),e===void 0&&t===void 0?(e=0,t=1):(e=D(e),t===void 0?(t=e,e=0):t=D(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var i=ns();return ts(e+i*(t-e+es(`1e-`+((i+``).length-1))),t)}return $o(e,t)}var B=rs,os=Math.ceil,ss=Math.max;function cs(e,t,n,r){for(var i=-1,a=ss(os((t-e)/(n||1)),0),o=Array(a);a--;)o[r?a:++i]=e,e+=n;return o}var ls=cs;function us(e){return function(t,n,r){return r&&typeof r!=`number`&&Lt(t,n,r)&&(n=r=void 0),t=D(t),n===void 0?(n=t,t=0):n=D(n),r=r===void 0?t<n?1:-1:D(r),ls(t,n,r,e)}}var V=us(),ds=9007199254740991,fs=4294967295,ps=Math.min;function ms(e,t){if(e=Ce(e),e<1||e>ds)return[];var n=fs,r=ps(e,fs);t=qo(t),e-=fs;for(var i=Ht(r,t);++n<e;)t(n);return i}var hs=ms,gs=Math.max;function _s(e){if(!(e&&e.length))return[];var t=0;return e=ji(e,function(e){if(Bo(e))return t=gs(e.length,t),!0}),Ht(t,function(t){return w(e,So(t))})}var vs=_s,ys=At(function(e,t){return Bo(e)?Go(e,t):[]}),bs=At(vs),xs=class{free_ids=[];next_id=0;components=[];systems=[];resources=new Map;create_entity(...e){let t=this.free_ids.pop()??this.next_id++;for(let[n,r]of e)this.add_component(t,n,r);return t}has_component(e,t){return this.components[t].has(e)}get_component(e,t){return this.components[t].get(e)}get_opt_component(e,t){return this.components[t].has(e)?this.components[t].get(e):null}add_component(e,t,n){let r=this.components[t];return r.has(e)?r.data[r.sparse[e]]=n:r.add(e,n),n}remove_component(e,t){let n=this.components[t];n.has(e)&&n.remove(e)}delete_entity(e){for(let t of this.components)t.has(e)&&t.remove(e);this.free_ids.push(e)}query(...e){let t=_i(this.components,e).reduce((e,t,n,r)=>e=t.data.length<r[n].data.length?n:e,0),n=_i(this.components,e),r=_i(this.components,ys(e,t)),i=[];for(let e of this.components[t].dense)r.every(t=>t.has(e))&&i.push([e,...n.map(t=>t.data[t.sparse[e]])]);return i}register_component(e){this.components[e]=new Ss}add_systems(...e){this.systems.push(...e)}run(){for(let e of this.systems)e(this)}loop=()=>{this.run(),this.just_started=!1,this.raf_id=requestAnimationFrame(this.loop)};raf_id=null;just_started=!1;start(){this.raf_id||(this.raf_id=requestAnimationFrame(this.loop),this.just_started=!0)}stop(){this.raf_id&&=(cancelAnimationFrame(this.raf_id),null)}step(){this.stop(),this.just_started=!0,this.run()}},Ss=class{sparse=[];dense=[];data=[];has(e){return this.dense[this.sparse[e]]===e}add(e,t){this.sparse[e]=this.dense.push(e)-1,this.data.push(t)}get(e){return this.data[this.sparse[e]]}remove(e){let t=this.sparse[e],n=this.dense.length-1;this.sparse[this.dense[n]]=t,this.dense[t]=this.dense[n],this.dense.pop(),this.data[t]=this.data[n],this.data.pop()}};function Cs(e,t){let n=e.s+t.s;return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n}function ws(e){let t=[],n=0;for(;e;)e&1&&t.push(n),e>>=1,n++;return t}var Ts=class{grid;n_cols;n_rows;entity_map;constructor(e,t,n,r){this.w=e,this.h=t,this.cell_size=n,this.collision_layers=r,this.n_cols=Math.ceil(e/n),this.n_rows=Math.ceil(t/n),this.grid=hs(this.collision_layers,()=>hs(this.n_rows,()=>hs(this.n_cols,()=>[]))),this.entity_map=new Map}reset(){for(let e of this.grid)for(let t of e)for(let e of t)e.length=0;this.entity_map.clear()}to_grid_indexes(e){let{x:t,y:n,s:r}=e,i=e=>Math.floor(e/this.cell_size),a=Math.max(0,i(t-r)),o=Math.min(this.n_cols-1,i(t+r)),s=Math.max(0,i(n-r)),c=Math.min(this.n_rows-1,i(n+r));return a<=o&&s<=c?[a,o,s,c]:[]}get_layers(e){return _i(this.grid,ws(e))}query(e,t){let n=new Set,r=this.get_layers(e),i=this.to_grid_indexes(t);if(i.length===0)return[];let[a,o,s,c]=i;for(let e of r)for(let r=a;r<=o;r++)for(let i=s;i<=c;i++)for(let a of e[i][r])Cs(t,this.entity_map.get(a))&&n.add(a);return[...n]}insert(e,t,n){let r=this.to_grid_indexes(n);if(r.length===0)return;let i=this.get_layers(t);this.entity_map.set(e,n);let[a,o,s,c]=r;for(let t of i)for(let n=a;n<=o;n++)for(let r=s;r<=c;r++)t[r][n].push(e)}};const H={zero:()=>({x:0,y:0}),add:(e,t)=>({x:e.x+t.x,y:e.y+t.y}),sub:(e,t)=>({x:e.x-t.x,y:e.y-t.y}),mul:(e,t)=>typeof e==`number`?{x:t.x*e,y:t.y*e}:{x:e.x*t.x,y:e.y*t.y},dot:(e,t)=>e.x*t.x+e.y*t.y,mag:e=>Math.hypot(e.x,e.y),sq_mag:e=>e.x**2+e.y**2,normed:e=>{let t=Math.hypot(e.x,e.y)+2**-52;return{x:e.x/t,y:e.y/t}},dist:(e,t)=>Math.hypot(e.x-t.x,e.y-t.y),angle:e=>Math.atan2(e.y,e.x),from_angle:(e,t=1)=>({x:Math.cos(e)*t,y:Math.sin(e)*t}),rotate:(e,t)=>{let n=Math.cos(e),r=Math.sin(e),i=t.x*n-t.y*r,a=t.x*r+t.y*n;return{x:i,y:a}},floor:e=>({x:Math.floor(e.x),y:Math.floor(e.y)})};var Es=[`#00ff2a5b`,`#1e1c21`,`#6f7078`,`#afb3b8`,`#ff00ffff`,`#6b36b1ff`,`#31e0ffff`,`#00b41bff`,`#e47600ff`,`#e03d6eff`,`#ffd900ff`,`#0004ffff`];let U=function(e){return e[e.Slime=0]=`Slime`,e[e.Black=1]=`Black`,e[e.Grey=2]=`Grey`,e[e.Silver=3]=`Silver`,e[e.Pink=4]=`Pink`,e[e.Indigo=5]=`Indigo`,e[e.Cyan=6]=`Cyan`,e[e.Green=7]=`Green`,e[e.Orange=8]=`Orange`,e[e.Red=9]=`Red`,e[e.Yellow=10]=`Yellow`,e[e.Blue=11]=`Blue`,e[e.cardinality=12]=`cardinality`,e}({});var Ds,W,Os;onmessage=e=>{let t=e.data;if(t.type===`init`){W=new OffscreenCanvas(t.w,t.h),Os=W.getContext(`2d`),Ds=t.worker_id;return}if(t.type===`render`){let e=W.width,n=W.height;Os.clearRect(0,0,e,n);let{frame_id:r,pos:i,size:a,color:o}=t;for(let e=0;e<i.length;e++){let t=a[e];Os.fillStyle=Es[o[e]],Os.fillRect(Math.floor(i[e].x-t),Math.floor(i[e].y-t),Math.floor(2*t),Math.floor(2*t))}createImageBitmap(W).then(e=>{let t={type:`bmp`,frame_id:r,worker_id:Ds,bmp:e};postMessage(t,{transfer:[e]})});return}};var ks=[[0,0,0],[0,255,255],[255,0,255],[255,255,0],[255,0,0],[0,255,0],[0,0,255]];let As=function(e){return e[e.White=0]=`White`,e[e.Red=1]=`Red`,e[e.Green=2]=`Green`,e[e.Blue=3]=`Blue`,e[e.Cyan=4]=`Cyan`,e[e.Magenta=5]=`Magenta`,e[e.Yellow=6]=`Yellow`,e}({});var js=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFCAYAAABSIVz6AAAAdElEQVR4AZTOQQ4DIQxD0Xbuf+eWF9WSFU0XgzB2fhDk+tR6/Vah2+jabeMBvDzyPou3DpqNTTiHvHXwbHxCHRhBnJLnY2Arw+OdU3PqXme9CN/578cumq7VbOfUfMsbGCd5Pu6JwAhvhcfT6zq53T01J/kLAAD//8R2uWMAAAAGSURBVAMAGC7Dq7DPgRkAAAAASUVORK5CYII=`,Ms=class{bmp;promise;constructor(e){this.promise=fetch(js).then(t=>t.blob().then(t=>createImageBitmap(t).then(t=>{if(e){let n=t.width,r=t.height,i=new OffscreenCanvas(n,r).getContext(`2d`);i.drawImage(t,0,0);let a=i.getImageData(0,0,n,r),o=a.data;for(let t=0;t<o.length;t+=4)for(let n=0;n<3;n++)o[t+n]-=e[n];return createImageBitmap(a).then(e=>this.bmp=e)}else return this.bmp=t})))}draw(e,t,n,r){let i=t.toString().split(``).map(Number);e.fillRect(n,r,4*i.length+1,7);for(let t=0;t<i.length;t++)e.drawImage(this.bmp,3*i[t],0,3,5,n+4*t+1,r+1,3,5)}},Ns,G,Ps,Fs=ks.map(e=>new Ms(e)),Is,Ls=!1;onmessage=e=>{let t=e.data;if(t.type===`init`){G=new OffscreenCanvas(t.w,t.h),Ps=G.getContext(`2d`,{willReadFrequently:!0}),Ns=t.worker_id,Promise.all(Fs.map(e=>e.promise)).then(e=>{Ls=!0;let t={type:`ready`,worker_id:Ns};postMessage(t)});return}if(t.type===`render`){if(!Ls)return;let{w:e,h:n}={w:G.width,h:G.height},{frame_id:r,pos:i,dmg:a,color:o}=t;Is!==void 0&&r-Is;let s=Ps.getImageData(0,0,e,n),c=s.data;for(let e=3;e<c.length;e+=4)c[e]-=Math.sqrt(256-c[e]);Ps.putImageData(s,0,0);for(let e=0;e<i.length;e++)Fs[o[e]].draw(Ps,a[e],Math.floor(i[e].x),Math.floor(i[e].y));createImageBitmap(G).then(e=>{let t={type:`bmp`,frame_id:r,worker_id:Ns,bmp:e};postMessage(t,{transfer:[e]})}),Is=r;return}};var Rs=class{state;constructor(e){this.state=e*e+1>>>0}next_u32(){let e=this.state;return e^=e<<13,e^=e>>>17,e^=e<<5,e>>>=0,this.state=e,e}rand_float(e,t){if(e===void 0)return this.next_u32()/4294967296;t===void 0&&(t=e,e=0);let n=this.next_u32()/4294967296;return e+n*(t-e)}rand_int(e,t){return t===void 0&&(t=e,e=0),Math.floor(this.rand_float(e,t+1))}rand_pick(e){return e[this.rand_int(e.length-1)]}};const zs={new_rect(){return{x:0,y:0,w:0,h:0}},in_bounds(e,t){return t.x>=e.x&&t.x<e.x+e.w&&t.y>=e.y&&t.y<e.y+e.h},clamp(e,t){return{x:Math.max(e.x,Math.min(e.x+e.w,t.x)),y:Math.max(e.y,Math.min(e.y+e.h,t.y))}},expand(e,t){return{x:e.x-t,y:e.y-t,w:e.w+2*t,h:e.h+2*t}}};var K=function(e){return e[e.Pos=0]=`Pos`,e[e.Vel=1]=`Vel`,e[e.Size=2]=`Size`,e[e.Color=3]=`Color`,e[e.Value=4]=`Value`,e[e.Stationary=5]=`Stationary`,e[e.cardinality=6]=`cardinality`,e}(K||{}),Bs=function(e){return e[e.COIN=1]=`COIN`,e[e.PICKER=2]=`PICKER`,e}(Bs||{}),Vs=class{ecs=new xs;grid;constructor(e){this.bounds=e,V(K.cardinality).forEach(e=>this.ecs.register_component(e)),this.grid=new Ts(e.w,e.h,10,1)}spawn_coin_pile(e,t,n){let r=[500,100,20,5,1],i=[0,0,1,1,2],a=[2.5,1.5,1.5,1,1],o=0,s=0;for(;o<r.length;){let c=r[o];if(e>=c){if(e-=c,this.ecs.create_entity([K.Pos,zs.clamp(this.bounds,t)],[K.Vel,H.add(n,{x:B(-40,40),y:B(-40,40)})],[K.Size,a[o]],[K.Color,i[o]],[K.Value,c]),s++,s===4)return}else o++}}physics(e){let t=e/1e3,n=this.ecs.components[K.Pos].data,r=this.ecs.components[K.Vel].data,{w:i,h:a}=this.bounds,o=this.ecs.components[K.Pos].dense;for(let e=0;e<n.length;e++){let s=n[e],c=r[e];(s.x<0&&c.x<0||s.x>i&&c.x>0)&&(c.x*=-1),(s.y<0&&c.y<0||s.y>a&&c.y>0)&&(c.y*=-1);let l=H.sq_mag(c);if(l<1){this.ecs.add_component(o[e],K.Stationary,null);continue}let u=Math.sqrt(l),d=Math.min(u,2);c.x-=d*c.x/u,c.y-=d*c.y/u,s.x+=t*c.x,s.y+=t*c.y}}pick(e,t){let n=[];this.grid.reset();let r=this.ecs.query(K.Stationary,K.Pos,K.Size);for(let[e,t,n,i]of r)this.grid.insert(e,Bs.COIN,{...n,s:i});let i=this.grid.query(Bs.COIN,{...e,s:t});for(let e of i)n.push([this.ecs.components[K.Value].get(e),this.grid.entity_map.get(e)]),this.ecs.delete_entity(e);return n}render(e,t){let n={type:`render`,frame_id:t,pos:this.ecs.components[K.Pos].data,size:this.ecs.components[K.Size].data,color:this.ecs.components[K.Color].data};e.postMessage(n)}},Hs=class{progress=0;constructor(e){this.interval=e}tick(e){this.progress+=e;let t=this.progress>this.interval;return t&&(this.progress=0),t}remaining(){return this.interval-this.progress}},Us={atk_speed:[2,e=>100+10*e],max_hit:[5,e=>e+2],hardness:[5,e=>e*.01],bullets:[5,e=>1+Math.sqrt(e)],mastery:[1,e=>e*.05],crit_chance:[1,e=>.1+e*.01],crit_mult:[1,e=>1.5+.1*e],frost_on_hit:[1,e=>2*e],loot_mult:[5,e=>1+e*.1],coin_picker:[1,e=>5+e],regen:[1,e=>e]},Ws=class{attack_timer;mana_progress;mana_gain;upgrades;hp;money;constructor(e,t){this.position=e,this.cfg=t,this.attack_timer=new Hs(250),this.mana_progress=new Hs(100),this.mana_gain=1,this.upgrades=Yo(Us,([e,t],n)=>new Gs(n,e,t)),this.hp=t.starting_hp,this.money=t.starting_money}tick(e){this.attack_timer.interval=4e4/this.upgrades.atk_speed.value;let t=this.attack_timer.tick(e),n=this.mana_progress.tick(e*this.mana_gain/1e3);return{attack_ready:t,mana_ready:n}}hardness_mult(e){return this.upgrades.hardness.value**e}bullet_count(){return Math.floor(this.upgrades.bullets.value)}bullet_velocity(){return 400}roll_damage(){let e=this.upgrades.max_hit.value,t=Math.max(1,Math.floor(this.upgrades.mastery.value*e)),n=B(t,e),r=Math.random()<this.upgrades.crit_chance.value,i=r?this.upgrades.crit_mult.value*n:n;return[r,Math.floor(i)]}},Gs=class{level=0;_value;constructor(e,t,n){this.name=e,this.cost=t,this._value=n}next_cost(){return Math.ceil(this.cost*1.1)}level_up(){this.level++,this.cost=this.next_cost()}get value(){return this._value(this.level)}get next_value(){return this._value(this.level+1)}},Ks=class{rng;wave_timer;mob_timer;wave_remaining_mobs=0;wave_modifiers=[];wave_number=0;mob_queue=[];kills=0;constructor(e){this.seed=e;let t=3e4;this.wave_timer=new Hs(t),this.wave_timer.progress=t,this.mob_timer=new Hs(0),this.rng=new Rs(e)}tick(e){if(this.wave_timer.tick(e)){this.wave_number++;let e=new Set;for(let t=0;t<this.wave_number/4;t++)e.add(this.rng.rand_int(q.cardinality-1));this.wave_modifiers=[...e],this.wave_remaining_mobs=this.is_boss_wave()?1:5+this.wave_number,this.mob_timer.interval=this.is_boss_wave()?.1*this.wave_timer.interval:.7*this.wave_timer.interval/this.wave_remaining_mobs}return this.wave_remaining_mobs&&this.mob_timer.tick(e)&&this.enqueue_mob(),this.mob_queue.pop()}enqueue_mob(){let e=V(U.Grey,U.cardinality),t=this.wave_number,n=3*1.1**t,r=.1*Math.sqrt(.1*this.wave_number),i=this.wave_modifiers.filter(e=>this.rng.rand_float()<r),a=new Set(i),o={approach_speed:8+.5*t,strafe_speed:B(0,10+2*t),chirality:Math.random()<.5?-1:1,max_hp:n,loot:.5*n,size:4,color:a.has(q.Slime)?U.Slime:e[(this.seed+t)%e.length],mods:a};if(this.is_boss_wave()){let e=(5+t)*2;o.max_hp*=e,o.loot*=e,o.strafe_speed*=.1,o.size*=5}i.forEach(e=>qs(this.rng,e,o)),this.wave_remaining_mobs--,this.mob_queue.push(o)}is_boss_wave(){return this.wave_number%10==0}anger(){V(this.wave_remaining_mobs).forEach(e=>this.enqueue_mob()),this.wave_timer.progress=this.wave_timer.interval}};let q=function(e){return e[e.Armored=0]=`Armored`,e[e.Fast=1]=`Fast`,e[e.Slime=2]=`Slime`,e[e.cardinality=3]=`cardinality`,e}({});function qs(e,t,n){switch(t){case q.Armored:n.size*=2.5,n.loot*=5,n.strafe_speed*=.3,n.approach_speed*=.5;break;case q.Fast:n.size*=.75,n.max_hp*=.5,n.approach_speed*=2,n.loot*=2;break;case q.Slime:n.max_hp*=.5,n.size*=1.5,n.loot*=3;break}}var Js=class{options=[];rng;reroll_cost=1;constructor(e,t){this.player=e,this.rng=new Rs(t),this.free_reroll()}free_reroll(){let e=Object.values(this.player.upgrades);this.options=V(3).map(t=>{let n=e[this.rng.rand_int(e.length-1)];return{i:t,upgradable:n,purchased:!1}})}reroll(){this.player.money<this.reroll_cost||(this.player.money-=this.reroll_cost,this.free_reroll())}purchase(e){let t=this.options[e],n=t.upgradable,r=n.cost;this.player.money<r||(t.purchased=!0,this.player.money-=r,n.level_up(),this.options.every(e=>e.purchased===!0)&&this.free_reroll(),this.options=[...this.options])}},J=class{_value;callbacks=[];constructor(e){this._value=e}get value(){return this._value}set value(e){e!==this._value&&(this.callbacks.forEach(t=>t(e)),this._value=e)}subscribe(e){this.callbacks.push(e),e(this._value)}},Ys=class{root;death_screen;event_queue=[];money=new J(0);d_money=new J(0);options=new J([]);wave_number=new J(0);mobs_remain=new J(0);wave_duration_remain=new J(0);hp=new J(0);kills=new J(0);_stage;key_listener;constructor(e,t,n,r,i){this.shop=e,this.player=t,this.stage=n,this.canvas=r,this._stage=new J(n),this.root=document.createElement(`div`);let a=document.createElement(`div`),o=new Text,s=new Text,c=new Text;a.append(`wave `,o,` (`,c,`)`),this.wave_number.subscribe(e=>o.textContent=e.toString()),this.mobs_remain.subscribe(e=>s.textContent=e.toString()),this.wave_duration_remain.subscribe(e=>c.textContent=(e/1e3).toFixed(2));let l=document.createElement(`div`);this.kills.subscribe(e=>l.innerText=`kill count ${e}`);let u=document.createElement(`div`);this.hp.subscribe(e=>u.innerText=`hp ${e.toFixed(0)}`);let d=document.createElement(`div`),f=new Text,p=new Text,m=Ro(()=>p.textContent=``,300);d.append(`money `,f,p),this.money.subscribe(e=>f.textContent=e.toString()),this.d_money.subscribe(e=>{e>0?p.textContent=` +${e}`:m()});let h=document.createElement(`button`);h.innerText=`[R]eroll $${e.reroll_cost}`,h.onclick=()=>this.shop.reroll(),this.money.subscribe(t=>h.disabled=t<e.reroll_cost);let g=document.createElement(`button`);g.innerText=`a[N]ger`,g.onclick=()=>{let e=this.stage.wave_timer;this.player.money+=Math.floor((e.interval-e.progress)/1e3),this.stage.anger()};let _=document.createElement(`div`),v=(e,t)=>{_.replaceChildren(...e.map((e,n)=>{let r=document.createElement(`button`),i=e.upgradable;return r.disabled=e.purchased,r.innerHTML=`[${`QWE`[n]}] <span>$${i.cost}</span> ${i.name} ${b(i.value)}->${b(i.next_value)}`,r.getElementsByTagName(`span`)[0].style.color=i.cost>t?`red`:`green`,r.onclick=()=>{this.shop.purchase(e.i),x()},r}))};this.options.subscribe(e=>v(e,this.money.value)),this.money.subscribe(e=>v(this.options.value,e));let y=document.createElement(`pre`),b=e=>Number.isInteger(e)||e>10?Math.round(e):e.toFixed(2),x=()=>{y.innerText=Object.values(this.player.upgrades).map(e=>`${e.name}: ${b(e.value)} (lv${e.level})`).join(`
`)};x(),this._stage.subscribe(e=>x());let S=document.createElement(`div`);S.innerText=`debug: [A] start [S] stop [D] step [F] reset stage`,this.root.append(a,l,u,d,h,g,_,y,S),this.key_listener=e=>{switch(e.key){case`r`:h.click();break;case`n`:g.click();break;case`q`:_.children[0].click();break;case`w`:_.children[1].click();break;case`e`:_.children[2].click();break}},this.death_screen=document.createElement(`div`);let C=this.death_screen,w=this.canvas.getBoundingClientRect();C.style.display=`none`,C.style.position=`absolute`,C.style.zIndex=`${Number(this.canvas.style.zIndex)+1}`,C.style.left=`${w.left}px`,C.style.top=`${w.top}px`,C.style.width=`${w.width}px`,C.style.height=`${w.height}px`,C.style.backgroundColor=`rgba(0, 0, 0, 0.8)`,C.innerHTML=`
            <h1 style="color: red">YOU DIED</h1>
            <p></p>
            <p></p>
            <p>click to continue</p>`,C.onclick=()=>{i(),C.style.display=`none`},document.body.append(C)}overlay_death_screen(e,t){this.death_screen.style.display=`block`;let n=this.death_screen.getElementsByTagName(`p`);n[0].innerHTML=`kills: ${e} best score: ${t}.`+(e>t?` starting money updated.`:``);var r=[`zamn, u are dead`,`couldn't square it`];e>10?r=[`no mouth to cry suffering`]:e>50?r=[`greedy...`]:e>200?r=[`stronger tomorrow`]:e>1e3&&(r=[`every thousand years the bird carries away one grain of sand`]),n[1].innerHTML=r[B(r.length-1)]}update(){this.d_money.value=this.player.money-this.money.value,this.money.value=this.player.money,this.options.value=this.shop.options,this.wave_number.value=this.stage.wave_number,this.mobs_remain.value=this.stage.wave_remaining_mobs,this.wave_duration_remain.value=this.stage.wave_timer.remaining(),this.hp.value=this.player.hp,this.kills.value=this.stage.kills,this._stage.value=this.stage}},Xs=[`coins`,`squares`,`damagenumbers`];function Zs(e){let t=new Worker(new URL(``+new URL(`compositor-DGqOZO1l.js`,import.meta.url).href,``+import.meta.url),{type:`module`}),n=e.transferControlToOffscreen(),r={type:`init`,offscreen:n,n_layers:Xs.length};t.postMessage(r,{transfer:[n]});let i=[new Worker(new URL(``+new URL(`coins-ClbqWE0v.js`,import.meta.url).href,``+import.meta.url),{type:`module`}),new Worker(new URL(``+new URL(`squares-Dmw0ObVW.js`,import.meta.url).href,``+import.meta.url),{type:`module`}),new Worker(new URL(``+new URL(`damagenumbers-D1IHdlhJ.js`,import.meta.url).href,``+import.meta.url),{type:`module`})],a=Xs.map((n,r)=>{let a=i[r],o={type:`init`,worker_id:r,w:e.width,h:e.height};return a.onmessage=e=>{let n=e.data;if(n.type===`bmp`){let{bmp:e}=n;t.postMessage(n,{transfer:[e]})}},a.postMessage(o),a});return window.onmessage=e=>{e.data.type},Object.fromEntries(bs(Xs,a))}var Y=function(e){return e[e.Pos=0]=`Pos`,e[e.Vel=1]=`Vel`,e[e.EdgeReflect=2]=`EdgeReflect`,e[e.Square=3]=`Square`,e[e.CollisionMask=4]=`CollisionMask`,e[e.Color=5]=`Color`,e[e.ZIndex=6]=`ZIndex`,e[e.Bullet=7]=`Bullet`,e[e.Enemy=8]=`Enemy`,e[e.Frost=9]=`Frost`,e[e.PlayerMarker=10]=`PlayerMarker`,e[e.cardinality=11]=`cardinality`,e}(Y||{}),Qs=function(e){return e[e.PLAYER=1]=`PLAYER`,e[e.ENEMY=2]=`ENEMY`,e}(Qs||{}),X=function(e){return e[e.Time=0]=`Time`,e[e.DeltaTime=1]=`DeltaTime`,e[e.Frame=2]=`Frame`,e[e.CanvasManager=3]=`CanvasManager`,e[e.CollisionGrid=4]=`CollisionGrid`,e[e.Player=5]=`Player`,e[e.Stage=6]=`Stage`,e[e.RenderWorkers=7]=`RenderWorkers`,e[e.CoinManager=8]=`CoinManager`,e[e.RenderDamageNumbers=9]=`RenderDamageNumbers`,e[e.Shop=10]=`Shop`,e[e.Persistent=11]=`Persistent`,e[e.UI=12]=`UI`,e}(X||{}),$s=class{scaling=1;mouse_input={x:0,y:0};constructor(e){this.canvas=e,e.addEventListener(`pointermove`,t=>{let n=e.getBoundingClientRect();this.mouse_input.x=(t.x-n.x)/this.scaling,this.mouse_input.y=(t.y-n.y)/this.scaling})}get bounds(){return{x:0,y:0,w:this.canvas.width,h:this.canvas.height}}set_scaling(e){this.scaling=e,this.canvas.style.width=`${e*vc}px`,this.canvas.style.height=`${e*$}px`,this.canvas.style.imageRendering=`pixelated`}};function ec(e){let t=performance.now(),n=e.resources.get(X.Time),r=e.just_started?17:t-n;e.resources.set(X.Time,t),e.resources.set(X.DeltaTime,r),e.resources.set(X.Frame,e.resources.get(X.Frame)+1)}function tc(e,t){let n={...e,collided:new Set,hp:e.max_hp};Z.create_entity([Y.Enemy,n],[Y.Pos,t],[Y.Vel,H.zero()],[Y.Square,[e.size]],[Y.Color,[e.color]],[Y.ZIndex,1],[Y.CollisionMask,Qs.ENEMY])}function nc(e){let t=e.resources.get(X.DeltaTime),n=e.resources.get(X.Stage),r=e.resources.get(X.Player),i=e.resources.get(X.CanvasManager),a=Math.max(...Object.values(i.bounds))/2,o=n.tick(t);if(o){let{add:e,mul:t,from_angle:n}=H,i=n(B(2*Math.PI)),s=e(r.position,t(a,i));tc(o,s)}}function rc(e){let t=e.query(Y.Enemy,Y.Pos,Y.Vel),n=e.resources.get(X.Player),{add:r,sub:i,normed:a,mul:o}=H;for(let[e,{approach_speed:s,strafe_speed:c,chirality:l},u,d]of t){let e=a(i(n.position,u)),t={x:e.y,y:-e.x};Object.assign(d,r(o(s,e),o(l*c,t)))}}function ic(e){let t=e.resources.get(X.DeltaTime),n=e.resources.get(X.Frame),r=e.resources.get(X.Player),i=e.resources.get(X.CanvasManager);if(r.hp<=0)return;let{attack_ready:a,mana_ready:o}=r.tick(t);if(a){let t=r.bullet_count(),a=r.bullet_velocity(),o=r.position,s=Math.PI/72,c=-.5*(t-1)*s,{sub:l,normed:u,mul:d,rotate:f}=H,p=u(l(i.mouse_input,o));for(let r of V(t)){let t=d(a,f(c+r*s,p)),i=e.create_entity([Y.Pos,{...o}],[Y.Vel,t],[Y.Square,[1]],[Y.Color,[U.Cyan]],[Y.ZIndex,2]),l={hash:(i+100)*(n+100),bounces:0};e.add_component(i,Y.Bullet,l)}}}function ac(e){let t=e.query(Y.Bullet),n=e.resources.get(X.Player);for(let[r,i]of t)(i.bounces>10||n.hardness_mult(i.bounces)<.1)&&e.delete_entity(r)}function oc(e){let t=e.resources.get(X.DeltaTime)/1e3,n=e.query(Y.Pos,Y.Vel),r=e.resources.get(X.CanvasManager),i=e.components[Y.Bullet],{w:a,h:o}=r.bounds;for(let[r,s,c]of n){if(i.has(r)){let e=i.get(r);(s.x<0&&c.x<0||s.x>a&&c.x>0)&&(c.x*=-1,e.bounces+=1),(s.y<0&&c.y<0||s.y>o&&c.y>0)&&(c.y*=-1,e.bounces+=1)}let n=e.get_opt_component(r,Y.Frost)??[0],l=5/(Math.sqrt(n[0])+5);s.x+=t*l*c.x,s.y+=t*l*c.y}}function sc(e){let t=e.query(Y.Frost);for(let[n,r]of t)--r[0],r[0]<=0&&e.remove_component(n,Y.Frost)}function cc(e){let t=e.resources.get(X.CollisionGrid),n=e.query(Y.Enemy,Y.Pos,Y.Square,Y.CollisionMask);t.reset();for(let[e,r,i,[a],o]of n)t.insert(e,o,{...i,s:a})}function lc(e){let t=e.query(Y.Bullet,Y.Pos,Y.Square),n=e.query(Y.Enemy),r=e.resources.get(X.Player),i=e.resources.get(X.CollisionGrid),a=e.resources.get(X.Stage),o=e.resources.get(X.UI);e.resources.get(X.CanvasManager);let s=e.resources.get(X.CoinManager),c=e.resources.get(X.RenderDamageNumbers),l=r.upgrades.loot_mult.value,{mul:u,sub:d,normed:f,add:p}=H,m=new Map(n);{let[t,n,a,[s]]=e.query(Y.PlayerMarker,Y.Pos,Y.Square)[0];for(let e of i.query(Qs.ENEMY,{...a,s})){if(r.hp<=0)break;--r.hp,c.pos.push(p(a,{x:B(-2,2),y:B(-2,2)})),c.dmg.push(1),c.color.push(As.Red)}if(r.hp<=0){let{kills:t,most_kills:n}=gc(e);o.death_screen.style.display===`none`&&o.overlay_death_screen(t,n)}else r.hp+=r.upgrades.regen.value/50}for(let[n,o,p,[h]]of t)for(let t of i.query(Qs.ENEMY,{...p,s:h})){let i=m.get(t);if(!i||i.hp<=0||i.collided.has(o.hash))continue;if(i.mods.has(q.Armored)&&Math.random()<.8){let t=e.components[Y.Vel].get(n);Object.assign(t,H.rotate(B(.5*Math.PI,1.5*Math.PI),t));continue}let[h,g]=r.roll_damage();c.pos.push(p),c.dmg.push(g),c.color.push(h?As.Magenta:As.White),i.hp-=g,o.bounces+=1,i.collided.add(o.hash);let _=e.get_opt_component(t,Y.Frost)??e.add_component(t,Y.Frost,[0]);if(_[0]+=r.upgrades.frost_on_hit.value,i.hp<=0){if(i.mods.has(q.Slime)&&i.size>=3){let n=e.get_component(t,Y.Pos),r=i.size;for(let e=0;e<2;e++){let e={...i};e.max_hp/=2,e.size/=Math.SQRT2,e.strafe_speed*=B(.5,.6),e.loot/=2,tc(e,H.add(n,{x:B(-r,r),y:B(-r,r)}))}}else s.spawn_coin_pile(l*i.loot,p,u(40,f(d(p,r.position)))),a.kills+=1;e.delete_entity(t)}}}function uc(e){let t=e.resources.get(X.CoinManager),n=e.resources.get(X.DeltaTime);t.physics(n)}function dc(e){let t=e.resources.get(X.CoinManager),n=e.resources.get(X.CanvasManager),r=e.resources.get(X.RenderDamageNumbers),i=e.resources.get(X.Player),a=i.upgrades.coin_picker.value;for(let[e,o]of t.pick(n.mouse_input,a))i.money+=e,r.pos.push(o),r.dmg.push(e),r.color.push(As.Yellow)}function fc(e){let t=e.query(Y.Pos,Y.Square,Y.Color,Y.ZIndex),n=e.resources.get(X.RenderWorkers),r=e.resources.get(X.Frame);function i(){t.sort((e,t)=>e[4]-t[4])}i();let a={type:`render`,frame_id:r,pos:[],size:[],color:[]};for(let[e,n,[r],[i]]of t)a.pos.push(n),a.size.push(r),a.color.push(i);n.squares.postMessage(a)}function pc(e){let t=e.resources.get(X.CoinManager),n=e.resources.get(X.RenderWorkers),r=e.resources.get(X.Frame);t.render(n.coins,r)}function mc(e){let t=e.resources.get(X.RenderWorkers),n=e.resources.get(X.Frame),r=e.resources.get(X.RenderDamageNumbers);r.frame_id=n,t.damagenumbers.postMessage(r),r.pos.length=0,r.dmg.length=0,r.color.length=0}function hc(e){e.resources.get(X.UI).update()}function gc(e){let t=e.resources.get(X.Stage)?.kills??0,n=e.resources.get(X.Persistent);return{persistent:n,most_kills:n.most_kills,kills:t}}function _c(e){let t=e.resources.get(X.CanvasManager),{persistent:n,most_kills:r,kills:i}=gc(e);n.most_kills=Math.max(r,i);for(let[t]of e.query(Y.Pos))e.delete_entity(t);let a=e.resources.get(X.CoinManager);for(let[e]of a.ecs.query(Y.Pos))a.ecs.delete_entity(e);let o=new Ks(69);e.resources.set(X.Stage,o);let s=new Ws({x:vc/2,y:$/2},{starting_hp:100,starting_money:n.most_kills});e.resources.set(X.Player,s),e.create_entity([Y.PlayerMarker,{}],[Y.Pos,s.position],[Y.Square,[2]],[Y.Color,[U.Blue]],[Y.ZIndex,3]);let c=new Js(s,69);e.resources.set(X.Shop,c);let l=e.resources.get(X.UI);if(l)l.stage=o,l.shop=c,l.player=s;else{let n=new Ys(c,s,o,t.canvas,()=>{console.log(`asdf`),_c(e)});e.resources.set(X.UI,n),document.body.append(n.root),document.onkeydown=n.key_listener}}const Z=new xs;V(Y.cardinality).forEach(e=>Z.register_component(e)),Z.resources.set(X.Time,0),Z.resources.set(X.DeltaTime,0),Z.resources.set(X.Frame,0);var Q=document.createElement(`canvas`),vc=400,$=300;Q.height=$,Q.width=vc,document.body.append(Q);var yc=new $s(Q);Z.resources.set(X.CanvasManager,yc),Z.resources.set(X.CollisionGrid,new Ts(vc,$,10,2)),Z.resources.set(X.RenderWorkers,Zs(Q));var bc=new Vs(yc.bounds);Z.resources.set(X.CoinManager,bc),Z.resources.set(X.RenderDamageNumbers,{type:`render`,frame_id:0,pos:[],dmg:[],color:[]}),Z.resources.set(X.Persistent,{most_kills:0}),Z.add_systems(ec,nc,ic,ac,rc,oc,sc,cc,lc,uc,dc,fc,pc,mc,hc),yc.set_scaling(2),ec(Z),_c(Z),Z.start();var xc={a:Z.start.bind(Z),s:Z.stop.bind(Z),d:Z.step.bind(Z),f:()=>_c(Z)};document.body.onkeydown=e=>{xc[e.key]?.()};</script>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
